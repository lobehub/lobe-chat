<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LobeHub Desktop Protocol URL Test (React)</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: system-ui; margin: 40px; line-height: 1.6; }
        .test-link {
            display: inline-block;
            padding: 12px 24px;
            background: #000000;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            margin: 8px 0;
            cursor: pointer;
            border: none;
            font-family: inherit;
        }
        .test-link:hover { background: #333333; }
        .url-box {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 4px;
            word-break: break-all;
            margin: 8px 0;
            font-family: monospace;
        }
        .section { margin: 32px 0; }
        .scheme-selector {
            margin: 16px 0;
        }
        .scheme-selector select {
            padding: 8px;
            margin-left: 8px;
        }
        .config-panel {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 16px 0;
        }
        .config-panel-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 24px;
        }
        @media (max-width: 1024px) {
            .config-panel-content {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            .config-right {
                order: -1;
            }
        }
        .config-left {
            min-width: 0;
        }
        .config-right {
            min-width: 0;
        }
        .json-preview {
            background: #ffffff;
            border: 1px solid #d0d0d0;
            border-radius: 6px;
            padding: 16px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            line-height: 1.4;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .json-preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }
        .json-preview-title {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        .copy-btn {
            padding: 4px 8px;
            background: #f0f0f0;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            color: #666;
        }
        .copy-btn:hover {
            background: #e0e0e0;
        }
        .url-preview {
            background: #f5f5f5;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            padding: 12px;
            font-family: monospace;
            font-size: 11px;
            word-break: break-all;
            margin-top: 12px;
            color: #444;
        }
        .config-form {
            display: grid;
            gap: 12px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .form-group label {
            font-weight: 500;
            font-size: 14px;
        }
        .form-group input, .form-group textarea, .form-group select {
            padding: 8px 12px;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            font-family: inherit;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 60px;
            font-family: monospace;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        .config-tabs {
            display: flex;
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 16px;
        }
        .config-tab {
            padding: 8px 16px;
            border: none;
            background: none;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        .config-tab.active {
            border-bottom-color: #000000;
            color: #000000;
            font-weight: 500;
        }
        .generate-btn {
            padding: 12px 24px;
            background: #000000;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            margin-right: 12px;
        }
        .generate-btn:hover {
            background: #333333;
        }
        .json-error {
            border-color: #ff4d4f !important;
            background-color: #fff2f0 !important;
        }
        .readonly-input {
            background-color: #f5f5f5;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // Configuration for test cases
        const INITIAL_TEST_CONFIG = {
            defaultScheme: 'lobehub-dev',
            baseProtocolPath: 'plugin/install',
            testCases: {
                lobehub: {
                    id: 'upstash-context7',
                    marketId: 'lobehub'
                },
                higress: {
                    id: 'mcp-e2bdev',
                    marketId: 'higress',
                    schema: {
                        identifier: 'mcp-e2bdev',
                        name: 'E2B Development Environment',
                        author: 'Higress AI',
                        description: 'Connect to E2B cloud development environments for code execution and testing',
                        version: '1.0.0',
                        icon: 'https://img.alicdn.com/imgextra/i2/O1CN01zGKIun1UEdfasSeCG_!!6000000002486-2-tps-200-200.png',
                        config: {
                            type: 'http',
                            url: 'https://mcp.higress.ai/mcp-e2bdev/cm9lh5x6s000ua801xvm25bkg'
                        }
                    }
                },
                smithery: {
                    id: 'weather-forecast-api',
                    marketId: 'smithery',
                    schema: {
                        identifier: 'weather-forecast-api',
                        name: 'Weather Forecast API',
                        author: 'Smithery Community',
                        description: 'Get real-time weather data and forecasts for any location worldwide',
                        version: '3.2.1',
                        icon: 'https://cdn-icons-png.flaticon.com/128/1163/1163661.png',
                        config: {
                            type: 'http',
                            url: 'https://api.smithery.ai/weather/v1/mcp',
                            headers: {
                                'Authorization': 'Bearer sk-smithery-weather-token',
                                'User-Agent': 'LobeChat/1.0'
                            }
                        }
                    }
                },
                mcprouter: {
                    id: 'amap-mcp',
                    marketId: 'mcprouter',
                    schema: {
                        identifier: 'amap-mcp',
                        name: 'Amap Maps Integration',
                        author: 'McpRouter',
                        description: 'Access Amap (È´òÂæ∑Âú∞Âõæ) services for location, navigation, and mapping through McpRouter',
                        version: '1.0.0',
                        icon: 'https://cdn-icons-png.flaticon.com/128/684/684908.png',
                        config: {
                            type: 'http',
                            url: 'https://mcprouter.to/amap-maps',
                            headers: {
                                'Authorization': 'Bearer <MCPROUTER_API_KEY>',
                                'HTTP-Referer': 'https://lobehub.com/',
                                'X-Title': 'LobeChat'
                            }
                        }
                    }
                },
                github: {
                    id: 'github-repo-analyzer',
                    marketId: null,
                    schema: {
                        identifier: 'github-repo-analyzer',
                        name: 'GitHub Repository Analyzer',
                        author: 'GitHub Community',
                        description: 'Analyze GitHub repositories, pull requests, issues, and code metrics',
                        version: '1.5.2',
                        homepage: 'https://github.com/community/github-mcp',
                        icon: 'https://cdn-icons-png.flaticon.com/128/25/25231.png',
                        config: {
                            type: 'stdio',
                            command: 'npx',
                            args: ['-y', '@github/mcp-repo-analyzer'],
                            env: {
                                NODE_ENV: 'production',
                                GITHUB_TOKEN: 'ghp_your_github_token',
                                GITHUB_API_URL: 'https://api.github.com'
                            }
                        }
                    }
                },
                special: {
                    id: 'special-chars-test',
                    marketId: null,
                    schema: {
                        identifier: 'special-chars-test',
                        name: 'Special Characters Plugin √± üöÄ',
                        author: 'Test <test@example.com>',
                        description: 'Description with "quotes" and \'apostrophes\' (Test)',
                        version: '1.0.0',
                        icon: 'https://cdn-icons-png.flaticon.com/128/2620/2620543.png',
                        config: {
                            type: 'stdio',
                            command: 'node',
                            args: ['test script.js', 'arg/with/slashes']
                        }
                    }
                },
                custom: {
                    id: 'my-custom-http-mcp',
                    marketId: null,
                    schema: {
                        identifier: 'my-custom-http-mcp',
                        name: 'My Custom HTTP MCP Server',  
                        author: 'Custom Developer',
                        description: 'A custom HTTP-based MCP server for personal projects',
                        version: '1.0.0',
                        homepage: 'https://github.com/username/my-custom-mcp',
                        icon: 'https://cdn-icons-png.flaticon.com/128/1055/1055687.png',
                        config: {
                            type: 'http',
                            url: 'https://my-server.example.com/mcp',
                            headers: {
                                'Authorization': 'Bearer your-api-token',
                                'X-Custom-Header': 'custom-value',
                                'User-Agent': 'LobeChat-Custom/1.0'
                            }
                        }
                    }
                }
            }
        };

                // Helper functions
        function generateRFCProtocolUrl(params) {
            const { id, schema, marketId, scheme = INITIAL_TEST_CONFIG.defaultScheme } = params;

            const baseUrl = `${scheme}://${INITIAL_TEST_CONFIG.baseProtocolPath}`;
            const searchParams = new URLSearchParams();

            if (marketId) {
                searchParams.set('marketId', marketId);
            }

            searchParams.set('id', id);

            // Âè™ÊúâÂú® schema Â≠òÂú®Êó∂ÊâçÊ∑ªÂä† schema ÂèÇÊï∞
            if (schema) {
            const schemaJson = JSON.stringify(schema);
            searchParams.set('schema', schemaJson);
            }

            return `${baseUrl}?${searchParams.toString()}`;
        }

        function safeJsonParse(jsonString, fallback = {}) {
            try {
                return JSON.parse(jsonString);
            } catch (e) {
                return fallback;
            }
        }

        // Components
        function SchemeSelector({ scheme, onSchemeChange }) {
            return (
                <div className="section">
                    <h2>Protocol Version Selection:</h2>
                    <div className="scheme-selector">
                        <label>Select Protocol Type:</label>
                        <select
                            value={scheme}
                            onChange={(e) => onSchemeChange(e.target.value)}
                        >
                            <option value="lobehub-dev">lobehub-dev:// (Development)</option>
                            <option value="lobehub">lobehub:// (Production)</option>
                            <option value="lobehub-beta">lobehub-beta:// (Beta)</option>
                            <option value="lobehub-nightly">lobehub-nightly:// (Nightly)</option>
                        </select>
                    </div>
                </div>
            );
        }

        function TestSteps() {
            return (
                <div className="section">
                    <h2>Test Steps:</h2>
                    <ol>
                        <li>Select the correct protocol type (choose lobehub-dev for development environment)</li>
                        <li>Ensure the corresponding LobeChat application is running</li>
                        <li>Click the test links below</li>
                        <li>The system should launch the corresponding LobeChat application</li>
                        <li>The application should display a plugin installation confirmation dialog</li>
                    </ol>
                </div>
            );
        }

        function JsonInput({ value, onChange, placeholder = "", rows = 3 }) {
            const [isValid, setIsValid] = useState(true);

            const handleChange = (e) => {
                const newValue = e.target.value;
                try {
                    JSON.parse(newValue);
                    setIsValid(true);
                } catch (error) {
                    setIsValid(false);
                }
                onChange(newValue);
            };

            return (
                <textarea
                    value={value}
                    onChange={handleChange}
                    placeholder={placeholder}
                    rows={rows}
                    className={!isValid ? 'json-error' : ''}
                    title={!isValid ? 'Invalid JSON syntax' : ''}
                />
            );
        }

        function ConfigForm({ type, config, onConfigChange }) {
            const updateField = (field, value) => {
                onConfigChange(type, {
                    ...config,
                    [field]: value
                });
            };

            const updateSchemaField = (field, value) => {
                onConfigChange(type, {
                    ...config,
                    schema: {
                        ...config.schema,
                        [field]: value
                    }
                });
            };

            const updateConfigField = (field, value) => {
                let newConfig = {
                    ...config.schema.config,
                    [field]: value
                };

                // ÂΩìÂàáÊç¢ËøûÊé•Á±ªÂûãÊó∂ÔºåÈáçÁΩÆÈÖçÁΩÆ‰ª•ÈÅøÂÖçÊ∑∑Ê∑Ü
                if (field === 'type') {
                    if (value === 'stdio') {
                        newConfig = {
                            type: 'stdio',
                            command: 'npx',
                            args: ['-y', 'my-custom-mcp-package'],
                            env: {
                                NODE_ENV: 'production',
                                CUSTOM_API_KEY: 'your-api-key-here'
                            }
                        };
                    } else if (value === 'http') {
                        newConfig = {
                            type: 'http',
                            url: 'https://my-server.example.com/mcp',
                            headers: {
                                'Authorization': 'Bearer your-api-token',
                                'X-Custom-Header': 'custom-value',
                                'User-Agent': 'LobeChat-Custom/1.0'
                            }
                        };
                    }
                }

                onConfigChange(type, {
                    ...config,
                    schema: {
                        ...config.schema,
                        config: newConfig
                    }
                });
            };

            const isLobehub = type === 'lobehub';
            const isCustom = type === 'custom';
            const isStdio = config.schema?.config?.type === 'stdio';
            const isHttp = config.schema?.config?.type === 'http';

            // LobeHub Official Âè™ÈúÄË¶Å Plugin ID
            if (isLobehub) {
                return (
                    <div className="config-form">
                        <div className="form-group">
                            <label>Plugin ID:</label>
                            <input
                                type="text"
                                value={config.id}
                                onChange={(e) => updateField('id', e.target.value)}
                                placeholder="e.g., upstash-context7, github-mcp, notion-mcp"
                            />
                        </div>
                        <div style={{
                            background: '#e6f4ff',
                            border: '1px solid #91caff',
                            borderRadius: '6px',
                            padding: '12px',
                            marginTop: '16px',
                            fontSize: '14px',
                            color: '#0958d9'
                        }}>
                            <strong>üí° LobeHub Official Plugin</strong>
                            <p style={{ margin: '4px 0 0 0' }}>
                                Âè™ÈúÄÊèê‰æõÊèí‰ª∂ IDÔºåÂÖ∂‰ªñÈÖçÁΩÆ‰ø°ÊÅØÂ∞Ü‰ªé LobeHub ÂÆòÊñπ marketplace Ëá™Âä®Ëé∑Âèñ„ÄÇ
                                <br />
                                MarketId Ëá™Âä®ËÆæÁΩÆ‰∏∫ "lobehub"„ÄÇ
                            </p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="config-form">
                    {isCustom && (
                        <div style={{
                            background: '#f6ffed',
                            border: '1px solid #b7eb8f',
                            borderRadius: '6px',
                            padding: '12px',
                            marginBottom: '16px',
                            fontSize: '14px',
                            color: '#389e0d'
                        }}>
                            <strong>üõ†Ô∏è Custom MCP Plugin</strong>
                            <p style={{ margin: '4px 0 0 0' }}>
                                Ëá™ÂÆö‰πâ MCP Êèí‰ª∂ÔºåÊó†ÈúÄ MarketId„ÄÇÊîØÊåÅ stdio Âíå HTTP ‰∏§ÁßçËøûÊé•ÊñπÂºè„ÄÇ
                                <br />
                                ÊÇ®ÈúÄË¶ÅÂÆåÊï¥ÈÖçÁΩÆÊâÄÊúâÂøÖÈúÄÁöÑÂèÇÊï∞ÂíåËøûÊé•‰ø°ÊÅØ„ÄÇ
                            </p>
                        </div>
                    )}
                    <div className="form-row">
                        <div className="form-group">
                            <label>Plugin ID:</label>
                            <input
                                type="text"
                                value={config.id}
                                onChange={(e) => updateField('id', e.target.value)}
                            />
                        </div>
                        {!isCustom && (
                            <div className="form-group">
                                <label>Market ID:</label>
                                <input
                                    type="text"
                                    value={config.marketId || ''}
                                    onChange={(e) => updateField('marketId', e.target.value)}
                                />
                            </div>
                        )}
                        {isCustom && (
                            <div className="form-group">
                                <label>Connection Type <span style={{ color: '#ff4d4f' }}>*</span>:</label>
                                <select
                                    value={config.schema?.config?.type || 'stdio'}
                                    onChange={(e) => updateConfigField('type', e.target.value)}
                                    style={{
                                        borderColor: config.schema?.config?.type ? '#d0d0d0' : '#ff7875',
                                        backgroundColor: config.schema?.config?.type ? '' : '#fff2f0'
                                    }}
                                >
                                    <option value="stdio">Stdio (Local Command)</option>
                                    <option value="http">HTTP (Remote Server)</option>
                                </select>
                                <small style={{ color: '#666', fontSize: '12px', marginTop: '4px', display: 'block' }}>
                                    üì° ÈÄâÊã© MCP ÊúçÂä°Âô®ÁöÑËøûÊé•ÊñπÂºè
                                </small>
                            </div>
                        )}
                    </div>
                    <div className="form-row">
                        <div className="form-group">
                            <label>Plugin Name:</label>
                            <input
                                type="text"
                                value={config.schema.name}
                                onChange={(e) => updateSchemaField('name', e.target.value)}
                            />
                        </div>
                        <div className="form-group">
                            <label>Author:</label>
                            <input
                                type="text"
                                value={config.schema.author}
                                onChange={(e) => updateSchemaField('author', e.target.value)}
                            />
                        </div>
                    </div>
                    <div className="form-group">
                        <label>Description:</label>
                        <input
                            type="text"
                            value={config.schema.description}
                            onChange={(e) => updateSchemaField('description', e.target.value)}
                        />
                    </div>
                    <div className="form-row">
                        <div className="form-group">
                            <label>Version:</label>
                            <input
                                type="text"
                                value={config.schema.version}
                                onChange={(e) => updateSchemaField('version', e.target.value)}
                            />
                        </div>
                        {config.schema.homepage && (
                            <div className="form-group">
                                <label>Homepage:</label>
                                <input
                                    type="text"
                                    value={config.schema.homepage}
                                    onChange={(e) => updateSchemaField('homepage', e.target.value)}
                                />
                            </div>
                        )}
                        {config.schema.icon && (
                            <div className="form-group">
                                <label>Icon:</label>
                                <input
                                    type="text"
                                    value={config.schema.icon}
                                    onChange={(e) => updateSchemaField('icon', e.target.value)}
                                    placeholder="https://example.com/icon.png"
                                />
                            </div>
                        )}
                        {isHttp && (
                            <div className="form-group">
                                <label>API URL <span style={{ color: '#ff4d4f' }}>*</span>:</label>
                                <input
                                    type="text"
                                    value={config.schema.config.url || ''}
                                    onChange={(e) => updateConfigField('url', e.target.value)}
                                    placeholder="https://mcp.example.com/plugin-name/unique-id"
                                    style={{
                                        borderColor: config.schema.config.url ? '#d0d0d0' : '#ff7875',
                                        backgroundColor: config.schema.config.url ? '' : '#fff2f0'
                                    }}
                                />
                                <small style={{ color: '#666', fontSize: '12px', marginTop: '4px', display: 'block' }}>
                                    üîó MCP ÊúçÂä°Âô®ÁöÑ HTTP Á´ØÁÇπ URLÔºàÂøÖÈúÄÔºâ
                                </small>
                            </div>
                        )}
                    </div>
                    {isStdio && (
                        <div className="form-row">
                            <div className="form-group">
                                <label>Command:</label>
                                <input
                                    type="text"
                                    value={config.schema.config.command}
                                    onChange={(e) => updateConfigField('command', e.target.value)}
                                />
                            </div>
                            <div className="form-group">
                                <label>Arguments (JSON array):</label>
                                <JsonInput
                                    value={JSON.stringify(config.schema.config.args || [])}
                                    onChange={(value) => updateConfigField('args', safeJsonParse(value, []))}
                                    rows={1}
                                />
                            </div>
                        </div>
                    )}
                    {isStdio && config.schema.config.env && (
                        <div className="form-group">
                            <label>Environment Variables (JSON):</label>
                            <JsonInput
                                value={JSON.stringify(config.schema.config.env || {})}
                                onChange={(value) => updateConfigField('env', safeJsonParse(value, {}))}
                            />
                        </div>
                    )}
                    {isHttp && (
                        <div className="form-group">
                            <label>Headers (JSON) - API ËÆ§ËØÅÂíåÈÖçÁΩÆ:</label>
                            <JsonInput
                                value={JSON.stringify(config.schema.config.headers || {})}
                                onChange={(value) => updateConfigField('headers', safeJsonParse(value, {}))}
                                placeholder='{"Authorization": "Bearer your-token", "HTTP-Referer": "https://lobehub.com/"}'
                            />
                            <small style={{ color: '#666', fontSize: '12px', marginTop: '4px', display: 'block' }}>
                                üîê HTTP ËØ∑Ê±ÇÂ§¥Ôºö
                                <br />‚Ä¢ Authorization: API ËÆ§ËØÅ token
                                <br />‚Ä¢ HTTP-Referer: Êù•Ê∫êÁΩëÁ´ôÔºàÊüê‰∫õÊúçÂä°ÈúÄË¶ÅÔºâ
                                <br />‚Ä¢ X-Title: Â∫îÁî®Ê†áËØÜÔºàÊüê‰∫õÊúçÂä°ÈúÄË¶ÅÔºâ
                            </small>
                        </div>
                    )}

                </div>
            );
        }

        function JsonPreview({ activeTab, config, scheme }) {
            const [copySuccess, setCopySuccess] = useState('');

            // ÁîüÊàêÈ¢ÑËßàÊï∞ÊçÆ
            const getPreviewData = () => {
                if (activeTab === 'lobehub') {
                    return {
                        id: config.id,
                        marketId: config.marketId
                    };
                } else if (activeTab === 'custom') {
                    return {
                        id: config.id,
                        schema: config.schema
                    };
                } else {
                    return {
                        id: config.id,
                        schema: config.schema,
                        marketId: config.marketId
                    };
                }
            };

            const previewData = getPreviewData();
            const generatedUrl = generateRFCProtocolUrl({ ...previewData, scheme });

            const copyToClipboard = async (text, type) => {
                try {
                    await navigator.clipboard.writeText(text);
                    setCopySuccess(type);
                    setTimeout(() => setCopySuccess(''), 2000);
                } catch (err) {
                    console.error('Failed to copy: ', err);
                }
            };

            return (
                <div className="config-right">
                    <div className="json-preview-header">
                        <div className="json-preview-title">üìã Parameters Preview</div>
                        <button
                            className="copy-btn"
                            onClick={() => copyToClipboard(JSON.stringify(previewData, null, 2), 'json')}
                        >
                            {copySuccess === 'json' ? '‚úÖ Copied!' : 'üìã Copy JSON'}
                        </button>
                    </div>
                    <div className="json-preview">
{JSON.stringify(previewData, null, 2)}
                    </div>

                    <div className="json-preview-header" style={{ marginTop: '20px' }}>
                        <div className="json-preview-title">üîó Generated URL</div>
                        <button
                            className="copy-btn"
                            onClick={() => copyToClipboard(generatedUrl, 'url')}
                        >
                            {copySuccess === 'url' ? '‚úÖ Copied!' : 'üìã Copy URL'}
                        </button>
                    </div>
                    <div className="url-preview">
{generatedUrl}
                    </div>
                </div>
            );
        }

        function ConfigPanel({ configs, onConfigChange, onResetToDefaults, scheme }) {
            const [activeTab, setActiveTab] = useState('lobehub');

            const tabs = [
                { key: 'lobehub', label: 'LobeHub Official' },
                { key: 'mcprouter', label: 'MCPRouter' },
                { key: 'higress', label: 'Higress Marketplace' },
                { key: 'smithery', label: 'Smithery Marketplace' },
                { key: 'custom', label: 'Custom MCP' },
                { key: 'github', label: 'GitHub MCP' },
                { key: 'special', label: 'Special Cases' }
            ];

            return (
                <div className="section">
                    <h2>‚öôÔ∏è Configuration Panel</h2>
                    <p>Use this panel to customize plugin parameters before generating test URLs. All JSON fields support syntax highlighting and real-time validation.</p>
                    <div className="config-panel">
                        <div className="config-tabs">
                            {tabs.map(tab => (
                                <button
                                    key={tab.key}
                                    className={`config-tab ${activeTab === tab.key ? 'active' : ''}`}
                                    onClick={() => setActiveTab(tab.key)}
                                >
                                    {tab.label}
                                </button>
                            ))}
                        </div>

                        <div className="config-panel-content">
                            <div className="config-left">
                                {tabs.map(tab => (
                                    <div
                                        key={tab.key}
                                        style={{ display: activeTab === tab.key ? 'block' : 'none' }}
                                    >
                                        <ConfigForm
                                            type={tab.key}
                                            config={configs[tab.key]}
                                            onConfigChange={onConfigChange}
                                        />
                                    </div>
                                ))}

                                <div style={{ marginTop: '20px' }}>
                                    <button className="generate-btn" onClick={onResetToDefaults}>
                                        üîÑ Reset to Defaults
                                    </button>
                                </div>
                            </div>

                            <JsonPreview
                                activeTab={activeTab}
                                config={configs[activeTab]}
                                scheme={scheme}
                            />
                        </div>
                    </div>
                </div>
            );
        }

        function TestCases({ scheme, configs }) {
            const testCases = [
                { key: 'lobehub', title: 'LobeHub Official Plugin (Upstash Context7)', emoji: 'üß†' },
                { key: 'mcprouter', title: 'MCPRouter Marketplace (Amap Maps)', emoji: 'üó∫Ô∏è' },
                { key: 'higress', title: 'Higress Marketplace (E2B Dev Environment)', emoji: '‚ö°' },
                { key: 'smithery', title: 'Smithery Marketplace (Weather API)', emoji: 'üå§Ô∏è' },
                { key: 'custom', title: 'Custom MCP Plugin', emoji: 'üõ†Ô∏è' },
                { key: 'github', title: 'GitHub Community MCP', emoji: 'üêô' },
                { key: 'special', title: 'Special Characters Test', emoji: '‚ú®' }
            ];

            const handleTestClick = (url) => {
                console.log('Clicked protocol link:', url);
                window.location.href = url;
            };

            return (
                <div className="section">
                    <h2>üìã Test Cases</h2>

                    {testCases.map((testCase, index) => {
                        const config = configs[testCase.key];

                        // ÂØπ‰∫é LobeHub OfficialÔºåÂè™‰º†ÈÄí id Âíå marketId
                        // ÂØπ‰∫é CustomÔºå‰∏ç‰º†ÈÄí marketIdÔºàÂõ†‰∏∫ÊòØ nullÔºâ
                        const urlParams = testCase.key === 'lobehub'
                            ? { id: config.id, marketId: config.marketId, scheme }
                            : testCase.key === 'custom'
                            ? { id: config.id, schema: config.schema, scheme }
                            : {
                                id: config.id,
                                schema: config.schema,
                                marketId: config.marketId,
                                scheme
                            };

                        const url = generateRFCProtocolUrl(urlParams);

                        // ÊòæÁ§∫ÂêçÁß∞ÔºöLobeHub ‰ΩøÁî® IDÔºåÂÖ∂‰ªñ‰ΩøÁî® schema.name
                        const displayName = testCase.key === 'lobehub'
                            ? config.id
                            : (config.schema?.name || config.id);

                        return (
                            <div key={testCase.key}>
                                <h3>{index + 1}. {testCase.title}</h3>
                                <div className="url-box">{url}</div>
                                <button
                                    className="test-link"
                                    onClick={() => handleTestClick(url)}
                                >
                                    {testCase.emoji} Test Install {displayName}
                                </button>
                            </div>
                        );
                    })}
                </div>
            );
        }

        function ManualTesting({ scheme, configs }) {
            const sampleUrl = generateRFCProtocolUrl({
                id: configs.lobehub.id,
                marketId: configs.lobehub.marketId,
                    scheme
                });

            return (
                <div className="section">
                    <h2>üîß Manual Testing</h2>
                    <p>You can also copy the URL directly to the address bar or test via command line:</p>
                    <h4>macOS Command Line Test:</h4>
                    <div className="url-box">open "{sampleUrl}"</div>
                    <h4>Windows Command Line Test:</h4>
                    <div className="url-box">start "{sampleUrl}"</div>
                </div>
            );
        }

        // Main App Component
        function ProtocolTester() {
            const [scheme, setScheme] = useState(INITIAL_TEST_CONFIG.defaultScheme);
            const [configs, setConfigs] = useState(INITIAL_TEST_CONFIG.testCases);

            const handleConfigChange = useCallback((type, newConfig) => {
                setConfigs(prev => ({
                    ...prev,
                    [type]: newConfig
                }));
            }, []);

            const handleResetToDefaults = useCallback(() => {
                if (confirm('Are you sure you want to reset all configurations to default values?')) {
                    setConfigs(INITIAL_TEST_CONFIG.testCases);
                    console.log('üìù Configuration reset to defaults');
                }
            }, []);

            useEffect(() => {
                console.log('üöÄ LobeHub Desktop Protocol URL Test (React) initialized');
            }, []);

            return (
                <div>
                    <h1>üöÄ LobeHub Desktop Protocol URL Test</h1>

                    <SchemeSelector scheme={scheme} onSchemeChange={setScheme} />

                    <TestSteps />

                    <ConfigPanel
                        configs={configs}
                        onConfigChange={handleConfigChange}
                        onResetToDefaults={handleResetToDefaults}
                        scheme={scheme}
                    />

                    <TestCases scheme={scheme} configs={configs} />

                    <ManualTesting scheme={scheme} configs={configs} />
                </div>
            );
        }

        // Expose global API for external customization
        window.LobeProtocolTest = {
            updateConfig: (newConfig) => {
                console.log('External config update:', newConfig);
            },
            getConfig: () => INITIAL_TEST_CONFIG,
            generateUrl: generateRFCProtocolUrl
        };

        // Render the app
        ReactDOM.render(<ProtocolTester />, document.getElementById('root'));
    </script>
</body>
</html>
