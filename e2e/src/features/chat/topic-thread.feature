@chat @topic
Feature: 话题和子话题
  测试聊天话题（Topic）和子话题（Thread）的管理功能

  Background:
    Given 应用正在运行

  # ============================================
  # 话题列表
  # ============================================

  @CHAT-TOPIC-001 @P1
  Scenario: 查看话题列表
    Given 我访问 "/chat"
    And 当前会话有多个话题
    Then 我应该看到话题面板
    And 话题列表应该显示所有话题
    And 应该显示话题标题

  @CHAT-TOPIC-002 @P1
  Scenario: 切换到话题面板
    Given 我访问 "/chat"
    When 我点击话题面板切换按钮
    Then 话题面板应该展开
    And 我应该看到话题列表

  # ============================================
  # 创建话题
  # ============================================

  @CHAT-TOPIC-003 @P1
  Scenario: 自动创建话题
    Given 我访问 "/chat"
    When 我发送第一条消息
    Then 应该自动创建一个话题
    And 话题应该有默认标题
    And 话题应该显示在话题列表中

  @CHAT-TOPIC-004 @P1
  Scenario: 手动保存为话题
    Given 我访问 "/chat"
    And 当前会话有消息记录
    When 我点击保存话题按钮
    And 我输入话题名称 "重要讨论"
    And 我确认保存
    Then 话题应该保存成功
    And 话题名称应该是 "重要讨论"
    And 话题应该显示在话题列表中

  # ============================================
  # 话题切换
  # ============================================

  @CHAT-TOPIC-005 @P1
  Scenario: 切换话题
    Given 我访问 "/chat"
    And 当前会话有多个话题
    When 我点击另一个话题
    Then 应该切换到该话题
    And 应该显示该话题的消息记录
    And URL 应该更新包含话题 ID

  @CHAT-TOPIC-006 @P1
  Scenario: 返回主对话
    Given 我访问 "/chat"
    And 我正在查看某个话题
    When 我点击返回主对话按钮
    Then 应该返回到主对话区
    And 应该显示所有消息

  # ============================================
  # 话题编辑
  # ============================================

  @CHAT-TOPIC-007 @P1
  Scenario: 重命名话题
    Given 我访问 "/chat"
    And 存在一个话题
    When 我右键点击话题项
    And 我选择重命名选项
    And 我输入新的话题名称
    And 我确认重命名
    Then 话题名称应该更新

  @CHAT-TOPIC-008 @P1
  Scenario: 编辑话题详情
    Given 我访问 "/chat"
    And 存在一个话题
    When 我点击话题项进入话题
    And 我点击编辑按钮
    Then 应该打开话题编辑界面
    And 我应该能修改话题信息

  # ============================================
  # 话题删除
  # ============================================

  @CHAT-TOPIC-009 @P1
  Scenario: 删除话题
    Given 我访问 "/chat"
    And 存在一个话题
    When 我右键点击话题项
    And 我选择删除选项
    And 我确认删除
    Then 话题应该被删除
    And 话题列表中不应该再显示该话题
    And 话题相关的消息应该被删除

  # ============================================
  # 子话题 (Thread)
  # ============================================

  @CHAT-TOPIC-010 @P1
  Scenario: 从消息创建子话题
    Given 我访问 "/chat"
    And 存在一条消息
    When 我悬停在消息上
    And 我点击创建子话题按钮
    Then 应该创建一个子话题
    And 应该打开子话题面板
    And 子话题应该关联到该消息

  @CHAT-TOPIC-011 @P1
  Scenario: 查看子话题列表
    Given 我访问 "/chat"
    And 某条消息有多个子话题
    When 我点击该消息的子话题按钮
    Then 应该显示子话题列表
    And 我应该看到所有子话题

  @CHAT-TOPIC-012 @P1
  Scenario: 在子话题中对话
    Given 我访问 "/chat"
    And 我已经打开一个子话题
    When 我在子话题输入框中输入消息
    And 我发送消息
    Then 消息应该只显示在子话题中
    And 不应该影响主对话

  @CHAT-TOPIC-013 @P1
  Scenario: 切换子话题
    Given 我访问 "/chat"
    And 某条消息有多个子话题
    And 我正在查看其中一个子话题
    When 我选择另一个子话题
    Then 应该切换到该子话题
    And 应该显示该子话题的消息

  @CHAT-TOPIC-014 @P1
  Scenario: 关闭子话题面板
    Given 我访问 "/chat"
    And 子话题面板已打开
    When 我点击关闭子话题按钮
    Then 子话题面板应该关闭
    And 应该返回到主对话视图

  @CHAT-TOPIC-015 @P1
  Scenario: 删除子话题
    Given 我访问 "/chat"
    And 存在一个子话题
    When 我在子话题中点击删除按钮
    And 我确认删除
    Then 子话题应该被删除
    And 子话题的消息应该被删除

  # ============================================
  # 子话题限制
  # ============================================

  @CHAT-TOPIC-016 @P1
  Scenario: 子话题中无法查看 Artifact
    Given 我访问 "/chat"
    And 我在子话题中
    And 主对话中有 Artifact
    Then 应该显示"子话题中无法查看"提示
    And 应该提示切换到主对话区

  # ============================================
  # 话题显示
  # ============================================

  @CHAT-TOPIC-017 @P1
  Scenario: 查看话题消息统计
    Given 我访问 "/chat"
    And 存在一个话题
    Then 我应该看到该话题的消息数量
    And 应该显示最后更新时间

  @CHAT-TOPIC-018 @P1
  Scenario: 话题骨架屏加载
    Given 我访问 "/chat"
    When 话题列表正在加载
    Then 应该显示话题骨架屏
    And 骨架屏应该模拟话题列表布局

  # ============================================
  # 话题搜索
  # ============================================

  @CHAT-TOPIC-019 @P2
  Scenario: 搜索话题
    Given 我访问 "/chat"
    And 存在多个话题
    When 我在话题搜索框中输入关键词
    Then 应该显示匹配的话题
    And 不匹配的话题应该被隐藏

  # ============================================
  # 移动端话题
  # ============================================

  @CHAT-TOPIC-020 @P2
  Scenario: 移动端打开话题模态框
    Given 我在移动端访问 "/chat"
    When 我点击话题按钮
    Then 应该打开话题模态框
    And 我应该看到话题列表
