# LobeChat åŠŸèƒ½å¼€å‘å®Œå…¨æŒ‡å—

æœ¬æ–‡æ¡£æ—¨åœ¨æŒ‡å¯¼å¼€å‘è€…äº†è§£å¦‚ä½•åœ¨ LobeChat ä¸­å¼€å‘ä¸€å—å®Œæ•´çš„åŠŸèƒ½éœ€æ±‚ã€‚

æˆ‘ä»¬å°†ä»¥ [RFC 021 - è‡ªå®šä¹‰åŠ©æ‰‹å¼€åœºå¼•å¯¼](https://github.com/lobehub/lobe-chat/discussions/891) ä¸ºä¾‹ï¼Œé˜è¿°å®Œæ•´çš„å®ç°æµç¨‹ã€‚

## ä¸€ã€æ›´æ–° schema

lobe-chat ä½¿ç”¨ postgres æ•°æ®åº“ï¼Œæµè§ˆå™¨ç«¯æœ¬åœ°æ•°æ®åº“ä½¿ç”¨ [pglite](https://pglite.dev/)ï¼ˆwasm ç‰ˆæœ¬ postgresï¼‰ã€‚é¡¹ç›®è¿˜ä½¿ç”¨äº† [drizzle](https://orm.drizzle.team/) ORM ç”¨æ¥æ“ä½œæ•°æ®åº“ã€‚

ç›¸æ¯”æ—§æ–¹æ¡ˆæµè§ˆå™¨ç«¯ä½¿ç”¨ indexDB æ¥è¯´ï¼Œæµè§ˆå™¨ç«¯å’Œ server ç«¯éƒ½ä½¿ç”¨ postgres å¥½å¤„åœ¨äº model å±‚ä»£ç å¯ä»¥å®Œå…¨å¤ç”¨ã€‚

schemas éƒ½ç»Ÿä¸€æ”¾åœ¨ `src/database/schemas`ï¼Œæˆ‘ä»¬éœ€è¦è°ƒæ•´ `agents` è¡¨å¢åŠ ä¸¤ä¸ªé…ç½®é¡¹å¯¹åº”çš„å­—æ®µï¼š

```diff
// src/database/schemas/agent.ts
export const agents = pgTable(
  'agents',
  {
    id: text('id')
      .primaryKey()
      .$defaultFn(() => idGenerator('agents'))
      .notNull(),
    avatar: text('avatar'),
    backgroundColor: text('background_color'),
    plugins: jsonb('plugins').$type<string[]>().default([]),
    // ...
    tts: jsonb('tts').$type<LobeAgentTTSConfig>(),

+   openingMessage: text('opening_message'),
+   openingQuestions: text('opening_questions').array().default([]),

    ...timestamps,
  },
  (t) => ({
    // ...
    // !: update index here
  }),
);

```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ‰äº›æ—¶å€™æˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦æ›´æ–°ç´¢å¼•ï¼Œä½†å¯¹äºè¿™ä¸ªéœ€æ±‚æˆ‘ä»¬æ²¡æœ‰ç›¸å…³çš„æ€§èƒ½ç“¶é¢ˆé—®é¢˜ï¼Œæ‰€ä»¥ä¸éœ€è¦æ›´æ–°ç´¢å¼•ã€‚

è°ƒæ•´å®Œ schema åæˆ‘ä»¬éœ€è¦è¿è¡Œ `npm run db:generateï¼Œ` ä½¿ç”¨ drizzle-kit è‡ªå¸¦çš„æ•°æ®åº“è¿ç§»èƒ½åŠ›ç”Ÿæˆå¯¹åº”çš„ç”¨äºè¿ç§»åˆ°æœ€æ–° schema çš„ sql ä»£ç ã€‚æ‰§è¡Œåä¼šäº§ç”Ÿå››ä¸ªæ–‡ä»¶ï¼š

- src/database/migrations/meta/\_journal.jsonï¼šä¿å­˜æ¯æ¬¡è¿ç§»çš„ç›¸å…³ä¿¡æ¯
- src/database/migrations/0021\_add\_agent\_opening\_settings.sqlï¼šæ­¤æ¬¡è¿ç§»çš„ sql å‘½ä»¤
- src/database/client/migrations.jsonï¼špglite ä½¿ç”¨çš„æ­¤æ¬¡è¿ç§»çš„ sql å‘½ä»¤
- src/database/migrations/meta/0021\_snapshot.jsonï¼šå½“å‰æœ€æ–°çš„å®Œæ•´æ•°æ®åº“å¿«ç…§

æ³¨æ„è„šæœ¬é»˜è®¤ç”Ÿæˆçš„è¿ç§» sql æ–‡ä»¶åä¸ä¼šåƒ `0021_add_agent_opening_settings.sql` è¿™æ ·è¯­ä¹‰æ¸…æ™°ï¼Œä½ éœ€è¦è‡ªå·±æ‰‹åŠ¨å¯¹å®ƒé‡å‘½åå¹¶ä¸”æ›´æ–° `src/database/migrations/meta/_journal.json`ã€‚

ä»¥å‰å®¢æˆ·ç«¯å­˜å‚¨ä½¿ç”¨ indexDB æ•°æ®è¿ç§»ç›¸å¯¹éº»çƒ¦ï¼Œç°åœ¨æœ¬åœ°ç«¯ä½¿ç”¨ pglite ä¹‹åæ•°æ®åº“è¿ç§»å°±æ˜¯ä¸€æ¡å‘½ä»¤çš„äº‹ï¼Œéå¸¸ç®€å•å¿«æ·ï¼Œä½ ä¹Ÿå¯ä»¥æ£€æŸ¥ç”Ÿæˆçš„è¿ç§» sql æ˜¯å¦æœ‰ä»€ä¹ˆä¼˜åŒ–ç©ºé—´ï¼Œæ‰‹åŠ¨è°ƒæ•´ã€‚

## äºŒã€æ›´æ–°æ•°æ®æ¨¡å‹

åœ¨ `src/types` ä¸‹å®šä¹‰äº†æˆ‘ä»¬é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„å„ç§æ•°æ®æ¨¡å‹ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨ drizzle schema å¯¼å‡ºçš„ç±»å‹ï¼Œä¾‹å¦‚ `export type NewAgent = typeof agents.$inferInsert;`ï¼Œè€Œæ˜¯æ ¹æ®å‰ç«¯éœ€æ±‚å’Œ db schema å®šä¹‰ä¸­å¯¹åº”å­—æ®µæ•°æ®ç±»å‹å®šä¹‰äº†å¯¹åº”çš„æ•°æ®æ¨¡å‹ã€‚

æ•°æ®æ¨¡å‹å®šä¹‰éƒ½æ”¾åœ¨ `src/types` æ–‡ä»¶å¤¹ä¸‹ï¼Œæ›´æ–° `src/types/agent/index.ts` ä¸­ `LobeAgentConfig` ç±»å‹ï¼š

```diff
export interface LobeAgentConfig {
  // ...
  chatConfig: LobeAgentChatConfig;
  /**
   * è§’è‰²æ‰€ä½¿ç”¨çš„è¯­è¨€æ¨¡å‹
   * @default gpt-4o-mini
   */
  model: string;

+  /**
+   * å¼€åœºç™½
+   */
+  openingMessage?: string;
+  /**
+   * å¼€åœºé—®é¢˜
+   */
+  openingQuestions?: string[];

  /**
   * è¯­è¨€æ¨¡å‹å‚æ•°
   */
  params: LLMParams;
  /**
   * å¯ç”¨çš„æ’ä»¶
   */
  plugins?: string[];

  /**
   *  æ¨¡å‹ä¾›åº”å•†
   */
  provider?: string;

  /**
   * ç³»ç»Ÿè§’è‰²
   */
  systemRole: string;

  /**
   * è¯­éŸ³æœåŠ¡
   */
  tts: LobeAgentTTSConfig;
}
```

## ä¸‰ã€Service å®ç° / Model å®ç°

- `model` å±‚å°è£…å¯¹ DB çš„å¯å¤ç”¨æ“ä½œ
- `service` å±‚å®ç°åº”ç”¨ä¸šåŠ¡é€»è¾‘

åœ¨ `src` ç›®å½•ä¸‹éƒ½æœ‰å¯¹åº”çš„é¡¶å±‚æ–‡ä»¶å¤¹ã€‚

æˆ‘ä»¬éœ€è¦æŸ¥çœ‹æ˜¯å¦éœ€è¦æ›´æ–°å…¶å®ç°ï¼Œagent é…ç½®åœ¨å‰ç«¯è¢«æŠ½è±¡æˆ session çš„é…ç½®ï¼Œåœ¨ `src/services/session/server.ts` ä¸­å¯ä»¥çœ‹åˆ°æœ‰ä¸ª service å‡½æ•° `updateSessionConfig`ï¼š

```typescript
export class ServerService implements ISessionService {
  // ...
  updateSessionConfig: ISessionService['updateSessionConfig'] = (id, config, signal) => {
    return lambdaClient.session.updateSessionConfig.mutate({ id, value: config }, { signal });
  };
}
```

è·³è½¬ `lambdaClient.session.updateSessionConfig` å®ç°ï¼Œå‘ç°å®ƒåªæ˜¯ç®€å•çš„ **merge** äº†æ–°çš„ config å’Œæ—§çš„ configã€‚

```typescript
export const sessionRouter = router({
  // ..
  updateSessionConfig: sessionProcedure
    .input(
      z.object({
        id: z.string(),
        value: z.object({}).passthrough().partial(),
      }),
    )
    .mutation(async ({ input, ctx }) => {
      const session = await ctx.sessionModel.findByIdOrSlug(input.id);
      // ...
      const mergedValue = merge(session.agent, input.value);
      return ctx.sessionModel.updateConfig(session.agent.id, mergedValue);
    }),
});
```

å¯ä»¥é¢„æƒ³çš„åˆ°ï¼Œæˆ‘ä»¬å‰ç«¯ä¼šå¢åŠ ä¸¤ä¸ªè¾“å…¥ï¼Œç”¨æˆ·ä¿®æ”¹çš„æ—¶å€™å»è°ƒç”¨è¿™ä¸ª `updateSessionConfig`ï¼Œè€Œç›®å‰çš„æ—¶å€™éƒ½æ²¡ç»†ç²’åº¦åˆ° config ä¸­çš„å…·ä½“å­—æ®µï¼Œå› æ­¤ï¼Œservice å±‚å’Œ model å±‚ä¸éœ€è¦ä¿®æ”¹ã€‚

## å››ã€å‰ç«¯å®ç°

### æ•°æ®æµ store å®ç°

lobe-chat ä½¿ç”¨ [zustand](https://zustand.docs.pmnd.rs/getting-started/introduction) ä½œä¸ºå…¨å±€çŠ¶æ€ç®¡ç†æ¡†æ¶ï¼Œå¯¹äºçŠ¶æ€ç®¡ç†çš„è¯¦ç»†å®è·µä»‹ç»ï¼Œå¯ä»¥æŸ¥é˜… [ğŸ“˜ çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ](/zh/docs/development/state-management/state-management-intro)ã€‚

å’Œ agent ç›¸å…³çš„ store æœ‰ä¸¤ä¸ªï¼š

- `src/features/AgentSetting/store` æœåŠ¡äº agent è®¾ç½®çš„å±€éƒ¨ store
- `src/store/agent` ç”¨äºè·å–å½“å‰ä¼šè¯ agent çš„ store

åè€…é€šè¿‡ `src/features/AgentSetting/AgentSettings.tsx` ä¸­ `AgentSettings` ç»„ä»¶çš„ `onConfigChange` ç›‘å¬å¹¶æ›´æ–°å½“å‰ä¼šè¯çš„ agent é…ç½®ã€‚

#### æ›´æ–° AgentSetting/store

é¦–å…ˆæˆ‘ä»¬æ›´æ–° initialStateï¼Œé˜…è¯» `src/features/AgentSetting/store/initialState.ts` åå¾—çŸ¥åˆå§‹ agent é…ç½®ä¿å­˜åœ¨ `src/const/settings/agent.ts` ä¸­çš„ `DEFAULT_AGENT_CONFIG`ï¼š

```diff
export const DEFAULT_AGENT_CONFIG: LobeAgentConfig = {
  chatConfig: DEFAULT_AGENT_CHAT_CONFIG,
  model: DEFAULT_MODEL,
+ openingQuestions: [],
  params: {
    frequency_penalty: 0,
    presence_penalty: 0,
    temperature: 1,
    top_p: 1,
  },
  plugins: [],
  provider: DEFAULT_PROVIDER,
  systemRole: '',
  tts: DEFAUTT_AGENT_TTS_CONFIG,
};
```

å…¶å®ä½ è¿™é‡Œä¸æ›´æ–°éƒ½å¯ä»¥ï¼Œå› ä¸º `openingQuestions` ç±»å‹æœ¬æ¥å°±æ˜¯å¯é€‰çš„ï¼Œ`openingMessage` æˆ‘è¿™é‡Œå°±ä¸æ›´æ–°äº†ã€‚

å› ä¸ºæˆ‘ä»¬å¢åŠ äº†ä¸¤ä¸ªæ–°å­—æ®µï¼Œä¸ºäº†æ–¹ä¾¿åœ¨ `src/features/AgentSetting/AgentOpening` æ–‡ä»¶å¤¹ä¸­ç»„ä»¶è®¿é—®å’Œæ€§èƒ½ä¼˜åŒ–ï¼Œæˆ‘ä»¬åœ¨ `src/features/AgentSetting/store/selectors.ts` å¢åŠ ç›¸å…³çš„ selectorsï¼š

```diff
import { DEFAULT_AGENT_CHAT_CONFIG } from '@/const/settings';
import { LobeAgentChatConfig } from '@/types/agent';

import { Store } from './action';

const chatConfig = (s: Store): LobeAgentChatConfig =>
  s.config.chatConfig || DEFAULT_AGENT_CHAT_CONFIG;

+export const DEFAULT_OPENING_QUESTIONS: string[] = [];
export const selectors = {
  chatConfig,
+ openingMessage: (s: Store) => s.config.openingMessage,
+ openingQuestions: (s: Store) => s.config.openingQuestions || DEFAULT_OPENING_QUESTIONS,
};
```

è¿™é‡Œæˆ‘ä»¬å°±ä¸å¢åŠ é¢å¤–çš„ action ç”¨äºæ›´æ–° agent config äº†ï¼Œå› ä¸ºæˆ‘è§‚å¯Ÿåˆ°å·²æœ‰çš„å…¶å®ƒä»£ç ä¹Ÿæ˜¯ç›´æ¥ä½¿ç”¨ç°æœ‰ä»£ç ä¸­ç»Ÿä¸€çš„ `setChatConfig`ï¼š

```typescript
export const store: StateCreator<Store, [['zustand/devtools', never]]> = (set, get) => ({
  setAgentConfig: (config) => {
    get().dispatchConfig({ config, type: 'update' });
  },
});
```

#### æ›´æ–° store/agent

åœ¨ç»„ä»¶ `src/app/[variants]/(main)/chat/(workspace)/@conversation/features/ChatList/WelcomeChatItem/WelcomeMessage.tsx` æˆ‘ä»¬ä½¿ç”¨äº†è¿™ä¸ª store ç”¨äºè·å–å½“å‰ agent é…ç½®ï¼Œç”¨æ¥æ¸²æŸ“ç”¨æˆ·è‡ªå®šä¹‰çš„å¼€åœºæ¶ˆæ¯å’Œå¼•å¯¼æ€§é—®é¢˜ã€‚

è¿™é‡Œå› ä¸ºåªéœ€è¦è¯»å–ä¸¤ä¸ªé…ç½®é¡¹ï¼Œæˆ‘ä»¬å°±ç®€å•çš„åŠ ä¸¤ä¸ª selectors å°±å¥½äº†ï¼š

æ›´æ–° `src/store/agent/slices/chat/selectors/agent.ts`ï¼š

```diff
// ...
+const openingQuestions = (s: AgentStoreState) =>
+  currentAgentConfig(s).openingQuestions || DEFAULT_OPENING_QUESTIONS;
+const openingMessage = (s: AgentStoreState) => currentAgentConfig(s).openingMessage || '';

export const agentSelectors = {
  // ...
  isInboxSession,
+ openingMessage,
+ openingQuestions,
};
```

### UI å®ç°å’Œ action ç»‘å®š

æˆ‘ä»¬è¿™æ¬¡è¦æ–°å¢ä¸€ä¸ªç±»åˆ«çš„è®¾ç½®ï¼Œ åœ¨ `src/features/AgentSetting` ä¸­å®šä¹‰äº† agent çš„å„ç§è®¾ç½®çš„ UI ç»„ä»¶ï¼Œè¿™æ¬¡æˆ‘ä»¬è¦å¢åŠ ä¸€ä¸ªè®¾ç½®ç±»å‹ï¼šå¼€åœºè®¾ç½®ã€‚å¢åŠ ä¸€ä¸ªæ–‡ä»¶å¤¹ `AgentOpening` å­˜æ”¾å¼€åœºè®¾ç½®ç›¸å…³çš„ç»„ä»¶ã€‚é¡¹ç›®ä½¿ç”¨äº†ï¼š

- [ant-design](https://ant.design/) å’Œ [lobe-uiï¼š](https://github.com/lobehub/lobe-ui)ç»„ä»¶åº“
- [antd-style](https://ant-design.github.io/antd-style) ï¼š css-in-js æ–¹æ¡ˆ
- [react-layout-kit](https://github.com/arvinxx/react-layout-kit)ï¼šå“åº”å¼å¸ƒå±€ç»„ä»¶
- [@ant-design/icons](https://ant.design/components/icon-cn) å’Œ [lucide](https://lucide.dev/icons/): å›¾æ ‡åº“
- [react-i18next](https://github.com/i18next/react-i18next) å’Œ [lobe-i18n](https://github.com/lobehub/lobe-cli-toolbox/tree/master/packages/lobe-i18n) ï¼ši18n æ¡†æ¶å’Œå¤šè¯­è¨€è‡ªåŠ¨ç¿»è¯‘å·¥å…·

lobe-chat æ˜¯ä¸ªå›½é™…åŒ–é¡¹ç›®ï¼Œæ–°åŠ çš„æ–‡æ¡ˆéœ€è¦æ›´æ–°é»˜è®¤çš„ `locale` æ–‡ä»¶ï¼š `src/locales/default/setting.ts` ã€‚

æˆ‘ä»¬ä»¥å­ç»„ä»¶ `OpeningQuestion.tsx` ä¸ºä¾‹ï¼Œç»„ä»¶å®ç°ï¼š

```typescript
// src/features/AgentSetting/AgentOpening/OpeningQuestions.tsx
'use client';

import { DeleteOutlined, PlusOutlined } from '@ant-design/icons';
import { SortableList } from '@lobehub/ui';
import { Button, Empty, Input } from 'antd';
import { createStyles } from 'antd-style';
import { memo, useCallback, useMemo, useState } from 'react';
import { useTranslation } from 'react-i18next';
import { Flexbox } from 'react-layout-kit';

import { useStore } from '../store';
import { selectors } from '../store/selectors';

const useStyles = createStyles(({ css, token }) => ({
  empty: css`
    margin-block: 24px;
    margin-inline: 0;
  `,
  questionItemContainer: css`
    margin-block-end: 8px;
    padding-block: 2px;
    padding-inline: 10px 0;
    background: ${token.colorBgContainer};
  `,
  questionItemContent: css`
    flex: 1;
  `,
  questionsList: css`
    width: 100%;
    margin-block-start: 16px;
  `,
  repeatError: css`
    margin: 0;
    color: ${token.colorErrorText};
  `,
}));

interface QuestionItem {
  content: string;
  id: number;
}

const OpeningQuestions = memo(() => {
  const { t } = useTranslation('setting');
  const { styles } = useStyles();
  const [questionInput, setQuestionInput] = useState('');

  // ä½¿ç”¨ selector è®¿é—®å¯¹åº”é…ç½®
  const openingQuestions = useStore(selectors.openingQuestions);
  // ä½¿ç”¨ action æ›´æ–°é…ç½®
  const updateConfig = useStore((s) => s.setAgentConfig);
  const setQuestions = useCallback(
    (questions: string[]) => {
      updateConfig({ openingQuestions: questions });
    },
    [updateConfig],
  );

  const addQuestion = useCallback(() => {
    if (!questionInput.trim()) return;

    setQuestions([...openingQuestions, questionInput.trim()]);
    setQuestionInput('');
  }, [openingQuestions, questionInput, setQuestions]);

  const removeQuestion = useCallback(
    (content: string) => {
      const newQuestions = [...openingQuestions];
      const index = newQuestions.indexOf(content);
      newQuestions.splice(index, 1);
      setQuestions(newQuestions);
    },
    [openingQuestions, setQuestions],
  );

  // å¤„ç†æ‹–æ‹½æ’åºåçš„é€»è¾‘
  const handleSortEnd = useCallback(
    (items: QuestionItem[]) => {
      setQuestions(items.map((item) => item.content));
    },
    [setQuestions],
  );

  const items: QuestionItem[] = useMemo(() => {
    return openingQuestions.map((item, index) => ({
      content: item,
      id: index,
    }));
  }, [openingQuestions]);

  const isRepeat = openingQuestions.includes(questionInput.trim());

  return (
    <Flexbox gap={8}>
      <Flexbox gap={4}>
        <Input
          addonAfter={
            <Button
              // don't allow repeat
              disabled={openingQuestions.includes(questionInput.trim())}
              icon={<PlusOutlined />}
              onClick={addQuestion}
              size="small"
              type="text"
            />
          }
          onChange={(e) => setQuestionInput(e.target.value)}
          onPressEnter={addQuestion}
          placeholder={t('settingOpening.openingQuestions.placeholder')}
          value={questionInput}
        />

        {isRepeat && (
          <p className={styles.repeatError}>{t('settingOpening.openingQuestions.repeat')}</p>
        )}
      </Flexbox>

      <div className={styles.questionsList}>
        {openingQuestions.length > 0 ? (
          <SortableList
            items={items}
            onChange={handleSortEnd}
            renderItem={(item) => (
              <SortableList.Item className={styles.questionItemContainer} id={item.id}>
                <SortableList.DragHandle />
                <div className={styles.questionItemContent}>{item.content}</div>
                <Button
                  icon={<DeleteOutlined />}
                  onClick={() => removeQuestion(item.content)}
                  type="text"
                />
              </SortableList.Item>
            )}
          />
        ) : (
          <Empty
            className={styles.empty}
            description={t('settingOpening.openingQuestions.empty')}
          />
        )}
      </div>
    </Flexbox>
  );
});

export default OpeningQuestions;
```

åŒæ—¶æˆ‘ä»¬éœ€è¦å°†ç”¨æˆ·è®¾ç½®çš„å¼€åœºé…ç½®å±•ç¤ºå‡ºæ¥ï¼Œè¿™ä¸ªæ˜¯åœ¨ chat é¡µé¢ï¼Œå¯¹åº”ç»„ä»¶åœ¨ `src/app/[variants]/(main)/chat/(workspace)/@conversation/features/ChatList/WelcomeChatItem/WelcomeMessage.tsx`ï¼š

```typescript
const WelcomeMessage = () => {
  const { t } = useTranslation('chat');

  // è·å–å½“å‰å¼€åœºé…ç½®
  const openingMessage = useAgentStore(agentSelectors.openingMessage);
  const openingQuestions = useAgentStore(agentSelectors.openingQuestions);

  const meta = useSessionStore(sessionMetaSelectors.currentAgentMeta, isEqual);
  const { isAgentEditable } = useServerConfigStore(featureFlagsSelectors);
  const activeId = useChatStore((s) => s.activeId);

  const agentSystemRoleMsg = t('agentDefaultMessageWithSystemRole', {
    name: meta.title || t('defaultAgent'),
    systemRole: meta.description,
  });

  const agentMsg = t(isAgentEditable ? 'agentDefaultMessage' : 'agentDefaultMessageWithoutEdit', {
    name: meta.title || t('defaultAgent'),
    url: `/chat/settings?session=${activeId}`,
  });

  const message = useMemo(() => {
    // ç”¨æˆ·è®¾ç½®äº†å°±ç”¨ç”¨æˆ·è®¾ç½®çš„
    if (openingMessage) return openingMessage;
    return !!meta.description ? agentSystemRoleMsg : agentMsg;
  }, [openingMessage, agentSystemRoleMsg, agentMsg, meta.description]);

  const chatItem = (
    <ChatItem
      avatar={meta}
      editing={false}
      message={message}
      placement={'left'}
      type={type === 'chat' ? 'block' : 'pure'}
    />
  );

  return openingQuestions.length > 0 ? (
    <Flexbox>
      {chatItem}
      {/* æ¸²æŸ“å¼•å¯¼æ€§é—®é¢˜ */}
      <OpeningQuestions mobile={mobile} questions={openingQuestions} />
    </Flexbox>
  ) : (
    chatItem
  );
};
export default WelcomeMessage;
```

## äº”ã€æµ‹è¯•

é¡¹ç›®ä½¿ç”¨ vitest è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚

ç”±äºæˆ‘ä»¬ç›®å‰ä¸¤ä¸ªæ–°çš„é…ç½®å­—æ®µéƒ½æ˜¯å¯é€‰çš„ï¼Œæ‰€ä»¥ç†è®ºä¸Šä½ ä¸æ›´æ–°æµ‹è¯•ä¹Ÿèƒ½è·‘é€šï¼Œä¸è¿‡ç”±äºæˆ‘ä»¬æŠŠå‰é¢æåˆ°çš„é»˜è®¤é…ç½® `DEFAULT_AGENT_CONFIG` å¢åŠ äº† `openingQuestions` å­—æ®µï¼Œè¿™å¯¼è‡´å¾ˆå¤šæµ‹è¯•è®¡ç®—å‡ºçš„é…ç½®éƒ½æ˜¯æœ‰è¿™ä¸ªå­—æ®µçš„ï¼Œå› æ­¤æˆ‘ä»¬è¿˜æ˜¯éœ€è¦æ›´æ–°ä¸€éƒ¨åˆ†æµ‹è¯•çš„å¿«ç…§ã€‚

å¯¹äºå½“å‰è¿™ä¸ªåœºæ™¯ï¼Œæˆ‘å»ºè®®æ˜¯æœ¬åœ°ç›´æ¥è·‘ä¸‹æµ‹è¯•ï¼Œçœ‹å“ªäº›æµ‹è¯•å¤±è´¥äº†ï¼Œé’ˆå¯¹éœ€è¦æ›´æ–°ï¼Œä¾‹å¦‚æµ‹è¯•æ–‡ä»¶ `src/store/agent/slices/chat/selectors/agent.test.ts` éœ€è¦æ‰§è¡Œä¸€ä¸‹ `bunx vitest -u src/store/agent/slices/chat/selectors/agent.test.ts` æ›´æ–°å¿«ç…§ã€‚

## æ€»ç»“

ä»¥ä¸Šå°±æ˜¯ LobeChat å¼€åœºè®¾ç½®åŠŸèƒ½çš„å®Œæ•´å®ç°æµç¨‹ã€‚å¼€å‘è€…å¯ä»¥å‚è€ƒæœ¬æ–‡æ¡£è¿›è¡Œç›¸å…³åŠŸèƒ½çš„å¼€å‘å’Œæµ‹è¯•ã€‚
