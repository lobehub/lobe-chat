[
  {
    "sql": [
      "CREATE TABLE IF NOT EXISTS \"agents\" (\r\n\t\"id\" text PRIMARY KEY NOT NULL,\r\n\t\"slug\" varchar(100),\r\n\t\"title\" text,\r\n\t\"description\" text,\r\n\t\"tags\" jsonb DEFAULT '[]'::jsonb,\r\n\t\"avatar\" text,\r\n\t\"background_color\" text,\r\n\t\"plugins\" jsonb DEFAULT '[]'::jsonb,\r\n\t\"user_id\" text NOT NULL,\r\n\t\"chat_config\" jsonb,\r\n\t\"few_shots\" jsonb,\r\n\t\"model\" text,\r\n\t\"params\" jsonb DEFAULT '{}'::jsonb,\r\n\t\"provider\" text,\r\n\t\"system_role\" text,\r\n\t\"tts\" jsonb,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\tCONSTRAINT \"agents_slug_unique\" UNIQUE(\"slug\")\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"agents_tags\" (\r\n\t\"agent_id\" text NOT NULL,\r\n\t\"tag_id\" integer NOT NULL,\r\n\tCONSTRAINT \"agents_tags_agent_id_tag_id_pk\" PRIMARY KEY(\"agent_id\",\"tag_id\")\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"agents_to_sessions\" (\r\n\t\"agent_id\" text NOT NULL,\r\n\t\"session_id\" text NOT NULL,\r\n\tCONSTRAINT \"agents_to_sessions_agent_id_session_id_pk\" PRIMARY KEY(\"agent_id\",\"session_id\")\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"files\" (\r\n\t\"id\" text PRIMARY KEY NOT NULL,\r\n\t\"user_id\" text NOT NULL,\r\n\t\"file_type\" varchar(255) NOT NULL,\r\n\t\"name\" text NOT NULL,\r\n\t\"size\" integer NOT NULL,\r\n\t\"url\" text NOT NULL,\r\n\t\"metadata\" jsonb,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"files_to_agents\" (\r\n\t\"file_id\" text NOT NULL,\r\n\t\"agent_id\" text NOT NULL,\r\n\tCONSTRAINT \"files_to_agents_file_id_agent_id_pk\" PRIMARY KEY(\"file_id\",\"agent_id\")\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"files_to_messages\" (\r\n\t\"file_id\" text NOT NULL,\r\n\t\"message_id\" text NOT NULL,\r\n\tCONSTRAINT \"files_to_messages_file_id_message_id_pk\" PRIMARY KEY(\"file_id\",\"message_id\")\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"files_to_sessions\" (\r\n\t\"file_id\" text NOT NULL,\r\n\t\"session_id\" text NOT NULL,\r\n\tCONSTRAINT \"files_to_sessions_file_id_session_id_pk\" PRIMARY KEY(\"file_id\",\"session_id\")\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"user_installed_plugins\" (\r\n\t\"user_id\" text NOT NULL,\r\n\t\"identifier\" text NOT NULL,\r\n\t\"type\" text NOT NULL,\r\n\t\"manifest\" jsonb,\r\n\t\"settings\" jsonb,\r\n\t\"custom_params\" jsonb,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\tCONSTRAINT \"user_installed_plugins_user_id_identifier_pk\" PRIMARY KEY(\"user_id\",\"identifier\")\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"market\" (\r\n\t\"id\" serial PRIMARY KEY NOT NULL,\r\n\t\"agent_id\" text,\r\n\t\"plugin_id\" integer,\r\n\t\"type\" text NOT NULL,\r\n\t\"view\" integer DEFAULT 0,\r\n\t\"like\" integer DEFAULT 0,\r\n\t\"used\" integer DEFAULT 0,\r\n\t\"user_id\" text NOT NULL,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"message_plugins\" (\r\n\t\"id\" text PRIMARY KEY NOT NULL,\r\n\t\"tool_call_id\" text,\r\n\t\"type\" text DEFAULT 'default',\r\n\t\"api_name\" text,\r\n\t\"arguments\" text,\r\n\t\"identifier\" text,\r\n\t\"state\" jsonb,\r\n\t\"error\" jsonb\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"message_tts\" (\r\n\t\"id\" text PRIMARY KEY NOT NULL,\r\n\t\"content_md5\" text,\r\n\t\"file_id\" text,\r\n\t\"voice\" text\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"message_translates\" (\r\n\t\"id\" text PRIMARY KEY NOT NULL,\r\n\t\"content\" text,\r\n\t\"from\" text,\r\n\t\"to\" text\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"messages\" (\r\n\t\"id\" text PRIMARY KEY NOT NULL,\r\n\t\"role\" text NOT NULL,\r\n\t\"content\" text,\r\n\t\"model\" text,\r\n\t\"provider\" text,\r\n\t\"favorite\" boolean DEFAULT false,\r\n\t\"error\" jsonb,\r\n\t\"tools\" jsonb,\r\n\t\"trace_id\" text,\r\n\t\"observation_id\" text,\r\n\t\"user_id\" text NOT NULL,\r\n\t\"session_id\" text,\r\n\t\"topic_id\" text,\r\n\t\"parent_id\" text,\r\n\t\"quota_id\" text,\r\n\t\"agent_id\" text,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"plugins\" (\r\n\t\"id\" serial PRIMARY KEY NOT NULL,\r\n\t\"identifier\" text NOT NULL,\r\n\t\"title\" text NOT NULL,\r\n\t\"description\" text,\r\n\t\"avatar\" text,\r\n\t\"author\" text,\r\n\t\"manifest\" text NOT NULL,\r\n\t\"locale\" text NOT NULL,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\tCONSTRAINT \"plugins_identifier_unique\" UNIQUE(\"identifier\")\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"plugins_tags\" (\r\n\t\"plugin_id\" integer NOT NULL,\r\n\t\"tag_id\" integer NOT NULL,\r\n\tCONSTRAINT \"plugins_tags_plugin_id_tag_id_pk\" PRIMARY KEY(\"plugin_id\",\"tag_id\")\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"session_groups\" (\r\n\t\"id\" text PRIMARY KEY NOT NULL,\r\n\t\"name\" text NOT NULL,\r\n\t\"sort\" integer,\r\n\t\"user_id\" text NOT NULL,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"sessions\" (\r\n\t\"id\" text PRIMARY KEY NOT NULL,\r\n\t\"slug\" varchar(100) NOT NULL,\r\n\t\"title\" text,\r\n\t\"description\" text,\r\n\t\"avatar\" text,\r\n\t\"background_color\" text,\r\n\t\"type\" text DEFAULT 'agent',\r\n\t\"user_id\" text NOT NULL,\r\n\t\"group_id\" text,\r\n\t\"pinned\" boolean DEFAULT false,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"tags\" (\r\n\t\"id\" serial PRIMARY KEY NOT NULL,\r\n\t\"slug\" text NOT NULL,\r\n\t\"name\" text,\r\n\t\"user_id\" text NOT NULL,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\tCONSTRAINT \"tags_slug_unique\" UNIQUE(\"slug\")\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"topics\" (\r\n\t\"id\" text PRIMARY KEY NOT NULL,\r\n\t\"session_id\" text,\r\n\t\"user_id\" text NOT NULL,\r\n\t\"favorite\" boolean DEFAULT false,\r\n\t\"title\" text,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"user_settings\" (\r\n\t\"id\" text PRIMARY KEY NOT NULL,\r\n\t\"tts\" jsonb,\r\n\t\"key_vaults\" text,\r\n\t\"general\" jsonb,\r\n\t\"language_model\" jsonb,\r\n\t\"system_agent\" jsonb,\r\n\t\"default_agent\" jsonb,\r\n\t\"tool\" jsonb\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"users\" (\r\n\t\"id\" text PRIMARY KEY NOT NULL,\r\n\t\"username\" text,\r\n\t\"email\" text,\r\n\t\"avatar\" text,\r\n\t\"phone\" text,\r\n\t\"first_name\" text,\r\n\t\"last_name\" text,\r\n\t\"is_onboarded\" boolean DEFAULT false,\r\n\t\"clerk_created_at\" timestamp with time zone,\r\n\t\"preference\" jsonb DEFAULT '{\"guide\":{\"moveSettingsToAvatar\":true,\"topic\":true},\"telemetry\":null,\"useCmdEnterToSend\":false}'::jsonb,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"key\" text,\r\n\tCONSTRAINT \"users_username_unique\" UNIQUE(\"username\")\r\n);\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"agents\" ADD CONSTRAINT \"agents_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"agents_tags\" ADD CONSTRAINT \"agents_tags_agent_id_agents_id_fk\" FOREIGN KEY (\"agent_id\") REFERENCES \"public\".\"agents\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"agents_tags\" ADD CONSTRAINT \"agents_tags_tag_id_tags_id_fk\" FOREIGN KEY (\"tag_id\") REFERENCES \"public\".\"tags\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"agents_to_sessions\" ADD CONSTRAINT \"agents_to_sessions_agent_id_agents_id_fk\" FOREIGN KEY (\"agent_id\") REFERENCES \"public\".\"agents\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"agents_to_sessions\" ADD CONSTRAINT \"agents_to_sessions_session_id_sessions_id_fk\" FOREIGN KEY (\"session_id\") REFERENCES \"public\".\"sessions\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"files\" ADD CONSTRAINT \"files_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"files_to_agents\" ADD CONSTRAINT \"files_to_agents_file_id_files_id_fk\" FOREIGN KEY (\"file_id\") REFERENCES \"public\".\"files\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"files_to_agents\" ADD CONSTRAINT \"files_to_agents_agent_id_agents_id_fk\" FOREIGN KEY (\"agent_id\") REFERENCES \"public\".\"agents\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"files_to_messages\" ADD CONSTRAINT \"files_to_messages_file_id_files_id_fk\" FOREIGN KEY (\"file_id\") REFERENCES \"public\".\"files\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"files_to_messages\" ADD CONSTRAINT \"files_to_messages_message_id_messages_id_fk\" FOREIGN KEY (\"message_id\") REFERENCES \"public\".\"messages\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"files_to_sessions\" ADD CONSTRAINT \"files_to_sessions_file_id_files_id_fk\" FOREIGN KEY (\"file_id\") REFERENCES \"public\".\"files\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"files_to_sessions\" ADD CONSTRAINT \"files_to_sessions_session_id_sessions_id_fk\" FOREIGN KEY (\"session_id\") REFERENCES \"public\".\"sessions\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"user_installed_plugins\" ADD CONSTRAINT \"user_installed_plugins_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"market\" ADD CONSTRAINT \"market_agent_id_agents_id_fk\" FOREIGN KEY (\"agent_id\") REFERENCES \"public\".\"agents\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"market\" ADD CONSTRAINT \"market_plugin_id_plugins_id_fk\" FOREIGN KEY (\"plugin_id\") REFERENCES \"public\".\"plugins\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"market\" ADD CONSTRAINT \"market_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"message_plugins\" ADD CONSTRAINT \"message_plugins_id_messages_id_fk\" FOREIGN KEY (\"id\") REFERENCES \"public\".\"messages\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"message_tts\" ADD CONSTRAINT \"message_tts_id_messages_id_fk\" FOREIGN KEY (\"id\") REFERENCES \"public\".\"messages\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"message_tts\" ADD CONSTRAINT \"message_tts_file_id_files_id_fk\" FOREIGN KEY (\"file_id\") REFERENCES \"public\".\"files\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"message_translates\" ADD CONSTRAINT \"message_translates_id_messages_id_fk\" FOREIGN KEY (\"id\") REFERENCES \"public\".\"messages\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"messages\" ADD CONSTRAINT \"messages_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"messages\" ADD CONSTRAINT \"messages_session_id_sessions_id_fk\" FOREIGN KEY (\"session_id\") REFERENCES \"public\".\"sessions\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"messages\" ADD CONSTRAINT \"messages_topic_id_topics_id_fk\" FOREIGN KEY (\"topic_id\") REFERENCES \"public\".\"topics\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"messages\" ADD CONSTRAINT \"messages_parent_id_messages_id_fk\" FOREIGN KEY (\"parent_id\") REFERENCES \"public\".\"messages\"(\"id\") ON DELETE set null ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"messages\" ADD CONSTRAINT \"messages_quota_id_messages_id_fk\" FOREIGN KEY (\"quota_id\") REFERENCES \"public\".\"messages\"(\"id\") ON DELETE set null ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"messages\" ADD CONSTRAINT \"messages_agent_id_agents_id_fk\" FOREIGN KEY (\"agent_id\") REFERENCES \"public\".\"agents\"(\"id\") ON DELETE set null ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"plugins_tags\" ADD CONSTRAINT \"plugins_tags_plugin_id_plugins_id_fk\" FOREIGN KEY (\"plugin_id\") REFERENCES \"public\".\"plugins\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"plugins_tags\" ADD CONSTRAINT \"plugins_tags_tag_id_tags_id_fk\" FOREIGN KEY (\"tag_id\") REFERENCES \"public\".\"tags\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"session_groups\" ADD CONSTRAINT \"session_groups_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"sessions\" ADD CONSTRAINT \"sessions_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"sessions\" ADD CONSTRAINT \"sessions_group_id_session_groups_id_fk\" FOREIGN KEY (\"group_id\") REFERENCES \"public\".\"session_groups\"(\"id\") ON DELETE set null ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"tags\" ADD CONSTRAINT \"tags_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"topics\" ADD CONSTRAINT \"topics_session_id_sessions_id_fk\" FOREIGN KEY (\"session_id\") REFERENCES \"public\".\"sessions\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"topics\" ADD CONSTRAINT \"topics_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"user_settings\" ADD CONSTRAINT \"user_settings_id_users_id_fk\" FOREIGN KEY (\"id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nCREATE INDEX IF NOT EXISTS \"messages_created_at_idx\" ON \"messages\" (\"created_at\");",
      "\r\nCREATE UNIQUE INDEX IF NOT EXISTS \"slug_user_id_unique\" ON \"sessions\" (\"slug\",\"user_id\");\r\n"
    ],
    "bps": true,
    "folderMillis": 1716982944425,
    "hash": "549e56b0ba274e55e8d6d40496df4edcc148bc12b44ea415289f491c604a86f2"
  },
  {
    "sql": [
      "ALTER TABLE \"messages\" ADD COLUMN \"client_id\" text;",
      "\r\nALTER TABLE \"session_groups\" ADD COLUMN \"client_id\" text;",
      "\r\nALTER TABLE \"sessions\" ADD COLUMN \"client_id\" text;",
      "\r\nALTER TABLE \"topics\" ADD COLUMN \"client_id\" text;",
      "\r\nCREATE INDEX IF NOT EXISTS \"messages_client_id_idx\" ON \"messages\" (\"client_id\");",
      "\r\nALTER TABLE \"messages\" ADD CONSTRAINT \"messages_client_id_unique\" UNIQUE(\"client_id\");",
      "\r\nALTER TABLE \"session_groups\" ADD CONSTRAINT \"session_groups_client_id_unique\" UNIQUE(\"client_id\");",
      "\r\nALTER TABLE \"sessions\" ADD CONSTRAINT \"sessions_client_id_unique\" UNIQUE(\"client_id\");",
      "\r\nALTER TABLE \"topics\" ADD CONSTRAINT \"topics_client_id_unique\" UNIQUE(\"client_id\");\r\n"
    ],
    "bps": true,
    "folderMillis": 1717153686544,
    "hash": "9ea70cb786d78d09f9e5e209a589b6d2ff5be5b74625ab1c83e0a9de91d90ff7"
  },
  {
    "sql": [
      "ALTER TABLE \"messages\" DROP CONSTRAINT \"messages_client_id_unique\";",
      "\r\nALTER TABLE \"session_groups\" DROP CONSTRAINT \"session_groups_client_id_unique\";",
      "\r\nALTER TABLE \"sessions\" DROP CONSTRAINT \"sessions_client_id_unique\";",
      "\r\nALTER TABLE \"topics\" DROP CONSTRAINT \"topics_client_id_unique\";",
      "\r\nDROP INDEX IF EXISTS \"messages_client_id_idx\";",
      "\r\nCREATE UNIQUE INDEX IF NOT EXISTS \"message_client_id_user_unique\" ON \"messages\" (\"client_id\",\"user_id\");",
      "\r\nALTER TABLE \"session_groups\" ADD CONSTRAINT \"session_group_client_id_user_unique\" UNIQUE(\"client_id\",\"user_id\");",
      "\r\nALTER TABLE \"sessions\" ADD CONSTRAINT \"sessions_client_id_user_id_unique\" UNIQUE(\"client_id\",\"user_id\");",
      "\r\nALTER TABLE \"topics\" ADD CONSTRAINT \"topic_client_id_user_id_unique\" UNIQUE(\"client_id\",\"user_id\");"
    ],
    "bps": true,
    "folderMillis": 1717587734458,
    "hash": "3625c7a62b571655d2f5493818370b53cb84b8774da5c8fef8754b2d6423bdae"
  },
  {
    "sql": [
      "CREATE TABLE IF NOT EXISTS \"user_budgets\" (\r\n\t\"id\" text PRIMARY KEY NOT NULL,\r\n\t\"free_budget_id\" text,\r\n\t\"free_budget_key\" text,\r\n\t\"subscription_budget_id\" text,\r\n\t\"subscription_budget_key\" text,\r\n\t\"package_budget_id\" text,\r\n\t\"package_budget_key\" text,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"user_subscriptions\" (\r\n\t\"id\" text PRIMARY KEY NOT NULL,\r\n\t\"user_id\" text NOT NULL,\r\n\t\"stripe_id\" text,\r\n\t\"currency\" text,\r\n\t\"pricing\" integer,\r\n\t\"billing_paid_at\" integer,\r\n\t\"billing_cycle_start\" integer,\r\n\t\"billing_cycle_end\" integer,\r\n\t\"cancel_at_period_end\" boolean,\r\n\t\"cancel_at\" integer,\r\n\t\"next_billing\" jsonb,\r\n\t\"plan\" text,\r\n\t\"recurring\" text,\r\n\t\"storage_limit\" integer,\r\n\t\"status\" integer,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL\r\n);\r\n",
      "\r\nALTER TABLE \"users\" ALTER COLUMN \"preference\" DROP DEFAULT;",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"user_budgets\" ADD CONSTRAINT \"user_budgets_id_users_id_fk\" FOREIGN KEY (\"id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"user_subscriptions\" ADD CONSTRAINT \"user_subscriptions_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nALTER TABLE \"users\" DROP COLUMN IF EXISTS \"key\";\r\n"
    ],
    "bps": true,
    "folderMillis": 1718460779230,
    "hash": "c95c3afdb9d99b84cc91fb93adad21d8f65f0989665bed91353779a99a7f8ae8"
  },
  {
    "sql": [
      "CREATE TABLE IF NOT EXISTS \"nextauth_accounts\" (\r\n\t\"access_token\" text,\r\n\t\"expires_at\" integer,\r\n\t\"id_token\" text,\r\n\t\"provider\" text NOT NULL,\r\n\t\"providerAccountId\" text NOT NULL,\r\n\t\"refresh_token\" text,\r\n\t\"scope\" text,\r\n\t\"session_state\" text,\r\n\t\"token_type\" text,\r\n\t\"type\" text NOT NULL,\r\n\t\"userId\" text NOT NULL,\r\n\tCONSTRAINT \"nextauth_accounts_provider_providerAccountId_pk\" PRIMARY KEY(\"provider\",\"providerAccountId\")\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"nextauth_authenticators\" (\r\n\t\"counter\" integer NOT NULL,\r\n\t\"credentialBackedUp\" boolean NOT NULL,\r\n\t\"credentialDeviceType\" text NOT NULL,\r\n\t\"credentialID\" text NOT NULL,\r\n\t\"credentialPublicKey\" text NOT NULL,\r\n\t\"providerAccountId\" text NOT NULL,\r\n\t\"transports\" text,\r\n\t\"userId\" text NOT NULL,\r\n\tCONSTRAINT \"nextauth_authenticators_userId_credentialID_pk\" PRIMARY KEY(\"userId\",\"credentialID\"),\r\n\tCONSTRAINT \"nextauth_authenticators_credentialID_unique\" UNIQUE(\"credentialID\")\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"nextauth_sessions\" (\r\n\t\"expires\" timestamp NOT NULL,\r\n\t\"sessionToken\" text PRIMARY KEY NOT NULL,\r\n\t\"userId\" text NOT NULL\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"nextauth_verificationtokens\" (\r\n\t\"expires\" timestamp NOT NULL,\r\n\t\"identifier\" text NOT NULL,\r\n\t\"token\" text NOT NULL,\r\n\tCONSTRAINT \"nextauth_verificationtokens_identifier_token_pk\" PRIMARY KEY(\"identifier\",\"token\")\r\n);\r\n",
      "\r\nALTER TABLE \"users\" ADD COLUMN \"full_name\" text;",
      "\r\nALTER TABLE \"users\" ADD COLUMN \"email_verified_at\" timestamp with time zone;",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"nextauth_accounts\" ADD CONSTRAINT \"nextauth_accounts_userId_users_id_fk\" FOREIGN KEY (\"userId\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"nextauth_authenticators\" ADD CONSTRAINT \"nextauth_authenticators_userId_users_id_fk\" FOREIGN KEY (\"userId\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"nextauth_sessions\" ADD CONSTRAINT \"nextauth_sessions_userId_users_id_fk\" FOREIGN KEY (\"userId\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n"
    ],
    "bps": true,
    "folderMillis": 1721724512422,
    "hash": "4e60c80a8712884180615dd6659e6a1b54f5a502a67038d4a1ba144fe9efaa46"
  },
  {
    "sql": [
      "-- Custom SQL migration file, put you code below! --\r\nCREATE EXTENSION IF NOT EXISTS vector;\r\n"
    ],
    "bps": true,
    "folderMillis": 1722944166657,
    "hash": "388346d588b45b08397cff3dce69914dd0d1675a571149e1a724a637c589478c"
  },
  {
    "sql": [
      "CREATE TABLE IF NOT EXISTS \"agents_files\" (\r\n\t\"file_id\" text NOT NULL,\r\n\t\"agent_id\" text NOT NULL,\r\n\t\"enabled\" boolean DEFAULT true,\r\n\t\"user_id\" text NOT NULL,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\tCONSTRAINT \"agents_files_file_id_agent_id_user_id_pk\" PRIMARY KEY(\"file_id\",\"agent_id\",\"user_id\")\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"agents_knowledge_bases\" (\r\n\t\"agent_id\" text NOT NULL,\r\n\t\"knowledge_base_id\" text NOT NULL,\r\n\t\"user_id\" text NOT NULL,\r\n\t\"enabled\" boolean DEFAULT true,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\tCONSTRAINT \"agents_knowledge_bases_agent_id_knowledge_base_id_pk\" PRIMARY KEY(\"agent_id\",\"knowledge_base_id\")\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"async_tasks\" (\r\n\t\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\r\n\t\"type\" text,\r\n\t\"status\" text,\r\n\t\"error\" jsonb,\r\n\t\"user_id\" text NOT NULL,\r\n\t\"duration\" integer,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"file_chunks\" (\r\n\t\"file_id\" varchar,\r\n\t\"chunk_id\" uuid,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\tCONSTRAINT \"file_chunks_file_id_chunk_id_pk\" PRIMARY KEY(\"file_id\",\"chunk_id\")\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"global_files\" (\r\n\t\"hash_id\" varchar(64) PRIMARY KEY NOT NULL,\r\n\t\"file_type\" varchar(255) NOT NULL,\r\n\t\"size\" integer NOT NULL,\r\n\t\"url\" text NOT NULL,\r\n\t\"metadata\" jsonb,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"knowledge_base_files\" (\r\n\t\"knowledge_base_id\" text NOT NULL,\r\n\t\"file_id\" text NOT NULL,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\tCONSTRAINT \"knowledge_base_files_knowledge_base_id_file_id_pk\" PRIMARY KEY(\"knowledge_base_id\",\"file_id\")\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"knowledge_bases\" (\r\n\t\"id\" text PRIMARY KEY NOT NULL,\r\n\t\"name\" text NOT NULL,\r\n\t\"description\" text,\r\n\t\"avatar\" text,\r\n\t\"type\" text,\r\n\t\"user_id\" text NOT NULL,\r\n\t\"is_public\" boolean DEFAULT false,\r\n\t\"settings\" jsonb,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"message_chunks\" (\r\n\t\"message_id\" text,\r\n\t\"chunk_id\" uuid,\r\n\tCONSTRAINT \"message_chunks_chunk_id_message_id_pk\" PRIMARY KEY(\"chunk_id\",\"message_id\")\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"message_queries\" (\r\n\t\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\r\n\t\"message_id\" text NOT NULL,\r\n\t\"rewrite_query\" text,\r\n\t\"user_query\" text,\r\n\t\"embeddings_id\" uuid\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"message_query_chunks\" (\r\n\t\"id\" text,\r\n\t\"query_id\" uuid,\r\n\t\"chunk_id\" uuid,\r\n\t\"similarity\" numeric(6, 5),\r\n\tCONSTRAINT \"message_query_chunks_chunk_id_id_query_id_pk\" PRIMARY KEY(\"chunk_id\",\"id\",\"query_id\")\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"chunks\" (\r\n\t\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\r\n\t\"text\" text,\r\n\t\"abstract\" text,\r\n\t\"metadata\" jsonb,\r\n\t\"index\" integer,\r\n\t\"type\" varchar,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"user_id\" text\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"embeddings\" (\r\n\t\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\r\n\t\"chunk_id\" uuid,\r\n\t\"embeddings\" vector(1024),\r\n\t\"model\" text,\r\n\t\"user_id\" text\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"unstructured_chunks\" (\r\n\t\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\r\n\t\"text\" text,\r\n\t\"metadata\" jsonb,\r\n\t\"index\" integer,\r\n\t\"type\" varchar,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"parent_id\" varchar,\r\n\t\"composite_id\" uuid,\r\n\t\"user_id\" text,\r\n\t\"file_id\" varchar\r\n);\r\n",
      "\r\nALTER TABLE \"files_to_messages\" RENAME TO \"messages_files\";",
      "\r\nDROP TABLE \"files_to_agents\";",
      "\r\nALTER TABLE \"files\" ADD COLUMN \"file_hash\" varchar(64);",
      "\r\nALTER TABLE \"files\" ADD COLUMN \"chunk_task_id\" uuid;",
      "\r\nALTER TABLE \"files\" ADD COLUMN \"embedding_task_id\" uuid;",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"agents_files\" ADD CONSTRAINT \"agents_files_file_id_files_id_fk\" FOREIGN KEY (\"file_id\") REFERENCES \"public\".\"files\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"agents_files\" ADD CONSTRAINT \"agents_files_agent_id_agents_id_fk\" FOREIGN KEY (\"agent_id\") REFERENCES \"public\".\"agents\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"agents_files\" ADD CONSTRAINT \"agents_files_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"agents_knowledge_bases\" ADD CONSTRAINT \"agents_knowledge_bases_agent_id_agents_id_fk\" FOREIGN KEY (\"agent_id\") REFERENCES \"public\".\"agents\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"agents_knowledge_bases\" ADD CONSTRAINT \"agents_knowledge_bases_knowledge_base_id_knowledge_bases_id_fk\" FOREIGN KEY (\"knowledge_base_id\") REFERENCES \"public\".\"knowledge_bases\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"agents_knowledge_bases\" ADD CONSTRAINT \"agents_knowledge_bases_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"async_tasks\" ADD CONSTRAINT \"async_tasks_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"file_chunks\" ADD CONSTRAINT \"file_chunks_file_id_files_id_fk\" FOREIGN KEY (\"file_id\") REFERENCES \"public\".\"files\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"file_chunks\" ADD CONSTRAINT \"file_chunks_chunk_id_chunks_id_fk\" FOREIGN KEY (\"chunk_id\") REFERENCES \"public\".\"chunks\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"knowledge_base_files\" ADD CONSTRAINT \"knowledge_base_files_knowledge_base_id_knowledge_bases_id_fk\" FOREIGN KEY (\"knowledge_base_id\") REFERENCES \"public\".\"knowledge_bases\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"knowledge_base_files\" ADD CONSTRAINT \"knowledge_base_files_file_id_files_id_fk\" FOREIGN KEY (\"file_id\") REFERENCES \"public\".\"files\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"knowledge_bases\" ADD CONSTRAINT \"knowledge_bases_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"message_chunks\" ADD CONSTRAINT \"message_chunks_message_id_messages_id_fk\" FOREIGN KEY (\"message_id\") REFERENCES \"public\".\"messages\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"message_chunks\" ADD CONSTRAINT \"message_chunks_chunk_id_chunks_id_fk\" FOREIGN KEY (\"chunk_id\") REFERENCES \"public\".\"chunks\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"message_queries\" ADD CONSTRAINT \"message_queries_message_id_messages_id_fk\" FOREIGN KEY (\"message_id\") REFERENCES \"public\".\"messages\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"message_queries\" ADD CONSTRAINT \"message_queries_embeddings_id_embeddings_id_fk\" FOREIGN KEY (\"embeddings_id\") REFERENCES \"public\".\"embeddings\"(\"id\") ON DELETE set null ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"message_query_chunks\" ADD CONSTRAINT \"message_query_chunks_id_messages_id_fk\" FOREIGN KEY (\"id\") REFERENCES \"public\".\"messages\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"message_query_chunks\" ADD CONSTRAINT \"message_query_chunks_query_id_message_queries_id_fk\" FOREIGN KEY (\"query_id\") REFERENCES \"public\".\"message_queries\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"message_query_chunks\" ADD CONSTRAINT \"message_query_chunks_chunk_id_chunks_id_fk\" FOREIGN KEY (\"chunk_id\") REFERENCES \"public\".\"chunks\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"messages_files\" ADD CONSTRAINT \"messages_files_file_id_files_id_fk\" FOREIGN KEY (\"file_id\") REFERENCES \"public\".\"files\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"messages_files\" ADD CONSTRAINT \"messages_files_message_id_messages_id_fk\" FOREIGN KEY (\"message_id\") REFERENCES \"public\".\"messages\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"chunks\" ADD CONSTRAINT \"chunks_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"embeddings\" ADD CONSTRAINT \"embeddings_chunk_id_chunks_id_fk\" FOREIGN KEY (\"chunk_id\") REFERENCES \"public\".\"chunks\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"embeddings\" ADD CONSTRAINT \"embeddings_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"unstructured_chunks\" ADD CONSTRAINT \"unstructured_chunks_composite_id_chunks_id_fk\" FOREIGN KEY (\"composite_id\") REFERENCES \"public\".\"chunks\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"unstructured_chunks\" ADD CONSTRAINT \"unstructured_chunks_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"unstructured_chunks\" ADD CONSTRAINT \"unstructured_chunks_file_id_files_id_fk\" FOREIGN KEY (\"file_id\") REFERENCES \"public\".\"files\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"files\" ADD CONSTRAINT \"files_file_hash_global_files_hash_id_fk\" FOREIGN KEY (\"file_hash\") REFERENCES \"public\".\"global_files\"(\"hash_id\") ON DELETE no action ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"files\" ADD CONSTRAINT \"files_chunk_task_id_async_tasks_id_fk\" FOREIGN KEY (\"chunk_task_id\") REFERENCES \"public\".\"async_tasks\"(\"id\") ON DELETE set null ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"files\" ADD CONSTRAINT \"files_embedding_task_id_async_tasks_id_fk\" FOREIGN KEY (\"embedding_task_id\") REFERENCES \"public\".\"async_tasks\"(\"id\") ON DELETE set null ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n"
    ],
    "bps": true,
    "folderMillis": 1724089032064,
    "hash": "1ca1f899ef511a493be9048c82e5ebb26ee6a6932e8847b74f82920f26e30084"
  },
  {
    "sql": [
      "-- step 1: create a temporary table to store the rows we want to keep\r\nCREATE TEMP TABLE embeddings_temp AS\r\nSELECT DISTINCT ON (chunk_id) *\r\nFROM embeddings\r\nORDER BY chunk_id, random();\r\n",
      "\r\n\r\n-- step 2: delete all rows from the original table\r\nDELETE FROM embeddings;\r\n",
      "\r\n\r\n-- step 3: insert the rows we want to keep back into the original table\r\nINSERT INTO embeddings\r\nSELECT * FROM embeddings_temp;\r\n",
      "\r\n\r\n-- step 4: drop the temporary table\r\nDROP TABLE embeddings_temp;\r\n",
      "\r\n\r\n-- step 5: now it's safe to add the unique constraint\r\nALTER TABLE \"embeddings\" ADD CONSTRAINT \"embeddings_chunk_id_unique\" UNIQUE(\"chunk_id\");\r\n"
    ],
    "bps": true,
    "folderMillis": 1724254147447,
    "hash": "5aeb17c5564576cf873564514f3450d529d89bcd9ca2dd4c7f55df6852ddcd0c"
  },
  {
    "sql": [
      "CREATE TABLE IF NOT EXISTS \"rag_eval_dataset_records\" (\r\n\t\"id\" integer PRIMARY KEY GENERATED ALWAYS AS IDENTITY (sequence name \"rag_eval_dataset_records_id_seq\" INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START WITH 1 CACHE 1),\r\n\t\"dataset_id\" integer NOT NULL,\r\n\t\"ideal\" text,\r\n\t\"question\" text,\r\n\t\"reference_files\" text[],\r\n\t\"metadata\" jsonb,\r\n\t\"user_id\" text,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"rag_eval_datasets\" (\r\n\t\"id\" integer PRIMARY KEY GENERATED ALWAYS AS IDENTITY (sequence name \"rag_eval_datasets_id_seq\" INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START WITH 30000 CACHE 1),\r\n\t\"description\" text,\r\n\t\"name\" text NOT NULL,\r\n\t\"knowledge_base_id\" text,\r\n\t\"user_id\" text,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"rag_eval_evaluations\" (\r\n\t\"id\" integer PRIMARY KEY GENERATED ALWAYS AS IDENTITY (sequence name \"rag_eval_evaluations_id_seq\" INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START WITH 1 CACHE 1),\r\n\t\"name\" text NOT NULL,\r\n\t\"description\" text,\r\n\t\"eval_records_url\" text,\r\n\t\"status\" text,\r\n\t\"error\" jsonb,\r\n\t\"dataset_id\" integer NOT NULL,\r\n\t\"knowledge_base_id\" text,\r\n\t\"language_model\" text,\r\n\t\"embedding_model\" text,\r\n\t\"user_id\" text,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL\r\n);\r\n",
      "\r\nCREATE TABLE IF NOT EXISTS \"rag_eval_evaluation_records\" (\r\n\t\"id\" integer PRIMARY KEY GENERATED ALWAYS AS IDENTITY (sequence name \"rag_eval_evaluation_records_id_seq\" INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START WITH 1 CACHE 1),\r\n\t\"question\" text NOT NULL,\r\n\t\"answer\" text,\r\n\t\"context\" text[],\r\n\t\"ideal\" text,\r\n\t\"status\" text,\r\n\t\"error\" jsonb,\r\n\t\"language_model\" text,\r\n\t\"embedding_model\" text,\r\n\t\"question_embedding_id\" uuid,\r\n\t\"duration\" integer,\r\n\t\"dataset_record_id\" integer NOT NULL,\r\n\t\"evaluation_id\" integer NOT NULL,\r\n\t\"user_id\" text,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL\r\n);\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"rag_eval_dataset_records\" ADD CONSTRAINT \"rag_eval_dataset_records_dataset_id_rag_eval_datasets_id_fk\" FOREIGN KEY (\"dataset_id\") REFERENCES \"public\".\"rag_eval_datasets\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"rag_eval_dataset_records\" ADD CONSTRAINT \"rag_eval_dataset_records_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"rag_eval_datasets\" ADD CONSTRAINT \"rag_eval_datasets_knowledge_base_id_knowledge_bases_id_fk\" FOREIGN KEY (\"knowledge_base_id\") REFERENCES \"public\".\"knowledge_bases\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"rag_eval_datasets\" ADD CONSTRAINT \"rag_eval_datasets_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"rag_eval_evaluations\" ADD CONSTRAINT \"rag_eval_evaluations_dataset_id_rag_eval_datasets_id_fk\" FOREIGN KEY (\"dataset_id\") REFERENCES \"public\".\"rag_eval_datasets\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"rag_eval_evaluations\" ADD CONSTRAINT \"rag_eval_evaluations_knowledge_base_id_knowledge_bases_id_fk\" FOREIGN KEY (\"knowledge_base_id\") REFERENCES \"public\".\"knowledge_bases\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"rag_eval_evaluations\" ADD CONSTRAINT \"rag_eval_evaluations_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"rag_eval_evaluation_records\" ADD CONSTRAINT \"rag_eval_evaluation_records_question_embedding_id_embeddings_id_fk\" FOREIGN KEY (\"question_embedding_id\") REFERENCES \"public\".\"embeddings\"(\"id\") ON DELETE set null ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"rag_eval_evaluation_records\" ADD CONSTRAINT \"rag_eval_evaluation_records_dataset_record_id_rag_eval_dataset_records_id_fk\" FOREIGN KEY (\"dataset_record_id\") REFERENCES \"public\".\"rag_eval_dataset_records\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"rag_eval_evaluation_records\" ADD CONSTRAINT \"rag_eval_evaluation_records_evaluation_id_rag_eval_evaluations_id_fk\" FOREIGN KEY (\"evaluation_id\") REFERENCES \"public\".\"rag_eval_evaluations\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"rag_eval_evaluation_records\" ADD CONSTRAINT \"rag_eval_evaluation_records_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n"
    ],
    "bps": true,
    "folderMillis": 1725366565650,
    "hash": "b1dd0c4bd43efc33b68ff3c5383c435eb62afcd0fdc6cd5994a90d98e25de69a"
  },
  {
    "sql": ["DROP TABLE \"user_budgets\";", "\r\nDROP TABLE \"user_subscriptions\";"],
    "bps": true,
    "folderMillis": 1729699958471,
    "hash": "eea3a1d9206e41b108d3b4bda2d8e36927ec025f77eb7199c018b63d64093d6a"
  },
  {
    "sql": [
      "DROP TABLE \"agents_tags\" CASCADE;",
      "\r\nDROP TABLE \"market\" CASCADE;",
      "\r\nDROP TABLE \"plugins\" CASCADE;",
      "\r\nDROP TABLE \"plugins_tags\" CASCADE;",
      "\r\nDROP TABLE \"tags\" CASCADE;",
      "\r\nALTER TABLE \"agents\" ADD COLUMN \"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"agents_files\" ADD COLUMN \"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"agents_knowledge_bases\" ADD COLUMN \"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"async_tasks\" ADD COLUMN \"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"files\" ADD COLUMN \"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"global_files\" ADD COLUMN \"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"knowledge_bases\" ADD COLUMN \"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"messages\" ADD COLUMN \"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"chunks\" ADD COLUMN \"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"unstructured_chunks\" ADD COLUMN \"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"rag_eval_dataset_records\" ADD COLUMN \"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"rag_eval_dataset_records\" ADD COLUMN \"updated_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"rag_eval_datasets\" ADD COLUMN \"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"rag_eval_evaluations\" ADD COLUMN \"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"rag_eval_evaluation_records\" ADD COLUMN \"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"rag_eval_evaluation_records\" ADD COLUMN \"updated_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"session_groups\" ADD COLUMN \"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"sessions\" ADD COLUMN \"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"topics\" ADD COLUMN \"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"user_installed_plugins\" ADD COLUMN \"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL;",
      "\r\nALTER TABLE \"users\" ADD COLUMN \"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL;"
    ],
    "bps": true,
    "folderMillis": 1730900133049,
    "hash": "605305371f634d926b5f7010954c4b8f5157f5b947a02ba52b5440a223727a6a"
  },
  {
    "sql": [
      "ALTER TABLE \"topics\" ADD COLUMN \"history_summary\" text;",
      "\r\nALTER TABLE \"topics\" ADD COLUMN \"metadata\" jsonb;\r\n"
    ],
    "bps": true,
    "folderMillis": 1731138670427,
    "hash": "93c4e9258670dc0d900c6c22b3b7dc7f0cedc79d845d122657b514f08e69834a"
  },
  {
    "sql": [
      "CREATE TABLE IF NOT EXISTS \"threads\" (\r\n\t\"id\" text PRIMARY KEY NOT NULL,\r\n\t\"title\" text,\r\n\t\"type\" text NOT NULL,\r\n\t\"status\" text DEFAULT 'active',\r\n\t\"topic_id\" text NOT NULL,\r\n\t\"source_message_id\" text NOT NULL,\r\n\t\"parent_thread_id\" text,\r\n\t\"user_id\" text NOT NULL,\r\n\t\"last_active_at\" timestamp with time zone DEFAULT now(),\r\n\t\"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL\r\n);\r\n",
      "\r\nALTER TABLE \"messages\" ADD COLUMN \"thread_id\" text;",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"threads\" ADD CONSTRAINT \"threads_topic_id_topics_id_fk\" FOREIGN KEY (\"topic_id\") REFERENCES \"public\".\"topics\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"threads\" ADD CONSTRAINT \"threads_parent_thread_id_threads_id_fk\" FOREIGN KEY (\"parent_thread_id\") REFERENCES \"public\".\"threads\"(\"id\") ON DELETE set null ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"threads\" ADD CONSTRAINT \"threads_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n",
      "\r\nDO $$ BEGIN\r\n ALTER TABLE \"messages\" ADD CONSTRAINT \"messages_thread_id_threads_id_fk\" FOREIGN KEY (\"thread_id\") REFERENCES \"public\".\"threads\"(\"id\") ON DELETE cascade ON UPDATE no action;\r\nEXCEPTION\r\n WHEN duplicate_object THEN null;\r\nEND $$;\r\n"
    ],
    "bps": true,
    "folderMillis": 1731858381716,
    "hash": "4e95e545e10595a821873340eb2be4ce29a31d4887d6eab5c57e9122af9b18e9"
  },
  {
    "sql": [
      "CREATE TABLE \"ai_models\" (\r\n\t\"id\" varchar(150) NOT NULL,\r\n\t\"display_name\" varchar(200),\r\n\t\"description\" text,\r\n\t\"organization\" varchar(100),\r\n\t\"enabled\" boolean,\r\n\t\"provider_id\" varchar(64) NOT NULL,\r\n\t\"type\" varchar(20) DEFAULT 'chat' NOT NULL,\r\n\t\"sort\" integer,\r\n\t\"user_id\" text NOT NULL,\r\n\t\"pricing\" jsonb,\r\n\t\"parameters\" jsonb DEFAULT '{}'::jsonb,\r\n\t\"config\" jsonb,\r\n\t\"abilities\" jsonb DEFAULT '{}'::jsonb,\r\n\t\"context_window_tokens\" integer,\r\n\t\"source\" varchar(20),\r\n\t\"released_at\" varchar(10),\r\n\t\"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\tCONSTRAINT \"ai_models_id_provider_id_user_id_pk\" PRIMARY KEY(\"id\",\"provider_id\",\"user_id\")\r\n);\r\n",
      "\r\nCREATE TABLE \"ai_providers\" (\r\n\t\"id\" varchar(64) NOT NULL,\r\n\t\"name\" text,\r\n\t\"user_id\" text NOT NULL,\r\n\t\"sort\" integer,\r\n\t\"enabled\" boolean,\r\n\t\"fetch_on_client\" boolean,\r\n\t\"check_model\" text,\r\n\t\"logo\" text,\r\n\t\"description\" text,\r\n\t\"key_vaults\" text,\r\n\t\"source\" varchar(20),\r\n\t\"settings\" jsonb,\r\n\t\"accessed_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL,\r\n\tCONSTRAINT \"ai_providers_id_user_id_pk\" PRIMARY KEY(\"id\",\"user_id\")\r\n);\r\n",
      "\r\nALTER TABLE \"ai_models\" ADD CONSTRAINT \"ai_models_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\r\nALTER TABLE \"ai_providers\" ADD CONSTRAINT \"ai_providers_user_id_users_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\") ON DELETE cascade ON UPDATE no action;"
    ],
    "bps": true,
    "folderMillis": 1735834653361,
    "hash": "47efcf4a847b449b05ab135f7c4a4ebbc75a4eaed26cd6ead73b47a6a2d58a49"
  },
  {
    "sql": ["ALTER TABLE \"messages\" ADD COLUMN \"reasoning\" jsonb;"],
    "bps": true,
    "folderMillis": 1737609172353,
    "hash": "2cb36ae4fcdd7b7064767e04bfbb36ae34518ff4bb1b39006f2dd394d1893868"
  },
  {
    "sql": [
      "ALTER TABLE \"messages\" ADD COLUMN \"search\" jsonb;",
      "\r\nALTER TABLE \"messages\" ADD COLUMN \"metadata\" jsonb;"
    ],
    "bps": true,
    "folderMillis": 1739901891891,
    "hash": "47ab68be1ccab95d4a4c42c77e9ea48e5c78671c2401363fb37707c820144c40"
  },
  {
    "sql": [
      "CREATE INDEX IF NOT EXISTS \"messages_topic_id_idx\" ON \"messages\" USING btree (\"topic_id\");",
      "\r\nCREATE INDEX IF NOT EXISTS \"messages_parent_id_idx\" ON \"messages\" USING btree (\"parent_id\");",
      "\r\nCREATE INDEX IF NOT EXISTS \"messages_quota_id_idx\" ON \"messages\" USING btree (\"quota_id\");\r\n"
    ],
    "bps": true,
    "folderMillis": 1741844738677,
    "hash": "7ed6b64348b01e0eb47b40356ec6bf180795b6fec28add5939db86e5df79b108"
  },
  {
    "sql": [
      "-- Complete User ID Migration Script\r\n-- Includes adding columns to all tables, populating data, and setting constraints\r\n\r\nBEGIN;",
      "\r\n\r\nCREATE INDEX \"file_hash_idx\" ON \"files\" USING btree (\"file_hash\");",
      "\r\n\r\n-- Step 1: Add nullable user_id columns to all required tables\r\nALTER TABLE \"global_files\" ADD COLUMN IF NOT EXISTS \"creator\" text;",
      "\r\nALTER TABLE \"knowledge_base_files\" ADD COLUMN IF NOT EXISTS \"user_id\" text;",
      "\r\nALTER TABLE \"message_chunks\" ADD COLUMN IF NOT EXISTS \"user_id\" text;",
      "\r\nALTER TABLE \"message_plugins\" ADD COLUMN IF NOT EXISTS \"user_id\" text;",
      "\r\nALTER TABLE \"message_queries\" ADD COLUMN IF NOT EXISTS \"user_id\" text;",
      "\r\nALTER TABLE \"message_query_chunks\" ADD COLUMN IF NOT EXISTS \"user_id\" text;",
      "\r\nALTER TABLE \"message_tts\" ADD COLUMN IF NOT EXISTS \"user_id\" text;",
      "\r\nALTER TABLE \"message_translates\" ADD COLUMN IF NOT EXISTS \"user_id\" text;",
      "\r\nALTER TABLE \"messages_files\" ADD COLUMN IF NOT EXISTS \"user_id\" text;",
      "\r\nALTER TABLE \"agents_to_sessions\" ADD COLUMN IF NOT EXISTS \"user_id\" text;",
      "\r\nALTER TABLE \"file_chunks\" ADD COLUMN IF NOT EXISTS \"user_id\" text;",
      "\r\nALTER TABLE \"files_to_sessions\" ADD COLUMN IF NOT EXISTS \"user_id\" text;",
      "\r\n\r\n-- Step 2: Populate user_id fields\r\n-- Retrieve user_id from associated tables\r\n\r\n-- Populate user_id for knowledge_base_files\r\nUPDATE \"knowledge_base_files\" AS kbf\r\nSET \"user_id\" = kb.\"user_id\"\r\n  FROM \"knowledge_bases\" AS kb\r\nWHERE kbf.\"knowledge_base_id\" = kb.\"id\";",
      "\r\n\r\n-- Populate user_id for message_chunks\r\nUPDATE \"message_chunks\" AS mc\r\nSET \"user_id\" = m.\"user_id\"\r\n  FROM \"messages\" AS m\r\nWHERE mc.\"message_id\" = m.\"id\";",
      "\r\n\r\n-- Populate user_id for message_plugins (directly from messages table)\r\nUPDATE \"message_plugins\" AS mp\r\nSET \"user_id\" = m.\"user_id\"\r\n  FROM \"messages\" AS m\r\nWHERE mp.\"id\" = m.\"id\";",
      "\r\n\r\n-- Populate user_id for message_queries\r\nUPDATE \"message_queries\" AS mq\r\nSET \"user_id\" = m.\"user_id\"\r\n  FROM \"messages\" AS m\r\nWHERE mq.\"message_id\" = m.\"id\";",
      "\r\n\r\n-- Populate user_id for message_query_chunks\r\nUPDATE \"message_query_chunks\" AS mqc\r\nSET \"user_id\" = mq.\"user_id\"\r\n  FROM \"message_queries\" AS mq\r\nWHERE mqc.\"query_id\" = mq.\"id\";",
      "\r\n\r\n-- Populate user_id for message_tts\r\nUPDATE \"message_tts\" AS mt\r\nSET \"user_id\" = m.\"user_id\"\r\n  FROM \"messages\" AS m\r\nWHERE mt.\"id\" = m.\"id\";",
      "\r\n\r\n-- Populate user_id for message_translates\r\nUPDATE \"message_translates\" AS mt\r\nSET \"user_id\" = m.\"user_id\"\r\n  FROM \"messages\" AS m\r\nWHERE mt.\"id\" = m.\"id\";",
      "\r\n\r\n-- Populate user_id for messages_files\r\nUPDATE \"messages_files\" AS mf\r\nSET \"user_id\" = m.\"user_id\"\r\n  FROM \"messages\" AS m\r\nWHERE mf.\"message_id\" = m.\"id\";",
      "\r\n\r\n-- Populate creator for global_files (get the first user who created the file from files table)\r\nUPDATE \"global_files\" AS gf\r\nSET \"creator\" = (\r\n  SELECT f.\"user_id\"\r\n  FROM \"files\" AS f\r\n  WHERE f.\"file_hash\" = gf.\"hash_id\"\r\n  ORDER BY f.\"created_at\" ASC\r\n  LIMIT 1\r\n  );",
      "\r\n\r\n-- Delete global_files records where no user has used the file in the files table\r\nDELETE FROM \"global_files\"\r\nWHERE \"creator\" IS NULL;",
      "\r\n\r\n-- Populate user_id for agents_to_sessions\r\nUPDATE \"agents_to_sessions\" AS ats\r\nSET \"user_id\" = a.\"user_id\"\r\n  FROM \"agents\" AS a\r\nWHERE ats.\"agent_id\" = a.\"id\";",
      "\r\n\r\n-- Populate user_id for file_chunks\r\nUPDATE \"file_chunks\" AS fc\r\nSET \"user_id\" = f.\"user_id\"\r\n  FROM \"files\" AS f\r\nWHERE fc.\"file_id\" = f.\"id\";",
      "\r\n\r\n-- Populate user_id for files_to_sessions\r\nUPDATE \"files_to_sessions\" AS fts\r\nSET \"user_id\" = f.\"user_id\"\r\n  FROM \"files\" AS f\r\nWHERE fts.\"file_id\" = f.\"id\";",
      "\r\n\r\n-- Get user_id from sessions table (handle potential NULL values)\r\nUPDATE \"files_to_sessions\" AS fts\r\nSET \"user_id\" = s.\"user_id\"\r\n  FROM \"sessions\" AS s\r\nWHERE fts.\"session_id\" = s.\"id\" AND fts.\"user_id\" IS NULL;",
      "\r\n\r\nUPDATE \"agents_to_sessions\" AS ats\r\nSET \"user_id\" = s.\"user_id\"\r\n  FROM \"sessions\" AS s\r\nWHERE ats.\"session_id\" = s.\"id\" AND ats.\"user_id\" IS NULL;",
      "\r\n\r\n-- Step 3: Check for any unpopulated records\r\nDO $$\r\nDECLARE\r\nkb_files_count INTEGER;\r\n    msg_chunks_count INTEGER;\r\n    msg_plugins_count INTEGER;\r\n    msg_queries_count INTEGER;\r\n    msg_query_chunks_count INTEGER;\r\n    msg_tts_count INTEGER;\r\n    msg_translates_count INTEGER;\r\n    msgs_files_count INTEGER;\r\n    agents_sessions_count INTEGER;\r\n    file_chunks_count INTEGER;\r\n    files_sessions_count INTEGER;\r\nBEGIN\r\nSELECT COUNT(*) INTO kb_files_count FROM \"knowledge_base_files\" WHERE \"user_id\" IS NULL;\r\nSELECT COUNT(*) INTO msg_chunks_count FROM \"message_chunks\" WHERE \"user_id\" IS NULL;\r\nSELECT COUNT(*) INTO msg_plugins_count FROM \"message_plugins\" WHERE \"user_id\" IS NULL;\r\nSELECT COUNT(*) INTO msg_queries_count FROM \"message_queries\" WHERE \"user_id\" IS NULL;\r\nSELECT COUNT(*) INTO msg_query_chunks_count FROM \"message_query_chunks\" WHERE \"user_id\" IS NULL;\r\nSELECT COUNT(*) INTO msg_tts_count FROM \"message_tts\" WHERE \"user_id\" IS NULL;\r\nSELECT COUNT(*) INTO msg_translates_count FROM \"message_translates\" WHERE \"user_id\" IS NULL;\r\nSELECT COUNT(*) INTO msgs_files_count FROM \"messages_files\" WHERE \"user_id\" IS NULL;\r\nSELECT COUNT(*) INTO agents_sessions_count FROM \"agents_to_sessions\" WHERE \"user_id\" IS NULL;\r\nSELECT COUNT(*) INTO file_chunks_count FROM \"file_chunks\" WHERE \"user_id\" IS NULL;\r\nSELECT COUNT(*) INTO files_sessions_count FROM \"files_to_sessions\" WHERE \"user_id\" IS NULL;\r\n\r\nIF kb_files_count > 0 OR msg_chunks_count > 0 OR msg_plugins_count > 0 OR\r\n       msg_queries_count > 0 OR msg_query_chunks_count > 0 OR msg_tts_count > 0 OR\r\n       msg_translates_count > 0 OR msgs_files_count > 0 OR agents_sessions_count > 0 OR\r\n       file_chunks_count > 0 OR files_sessions_count > 0 THEN\r\n        RAISE EXCEPTION 'There are records with NULL user_id values that could not be populated';\r\nEND IF;\r\nEND $$;",
      "\r\n\r\n-- Step 4: Add NOT NULL constraints and foreign keys\r\nALTER TABLE \"knowledge_base_files\" ALTER COLUMN \"user_id\" SET NOT NULL;",
      "\r\nALTER TABLE \"message_chunks\" ALTER COLUMN \"user_id\" SET NOT NULL;",
      "\r\nALTER TABLE \"message_plugins\" ALTER COLUMN \"user_id\" SET NOT NULL;",
      "\r\nALTER TABLE \"message_queries\" ALTER COLUMN \"user_id\" SET NOT NULL;",
      "\r\nALTER TABLE \"message_query_chunks\" ALTER COLUMN \"user_id\" SET NOT NULL;",
      "\r\nALTER TABLE \"message_tts\" ALTER COLUMN \"user_id\" SET NOT NULL;",
      "\r\nALTER TABLE \"message_translates\" ALTER COLUMN \"user_id\" SET NOT NULL;",
      "\r\nALTER TABLE \"messages_files\" ALTER COLUMN \"user_id\" SET NOT NULL;",
      "\r\nALTER TABLE \"agents_to_sessions\" ALTER COLUMN \"user_id\" SET NOT NULL;",
      "\r\nALTER TABLE \"file_chunks\" ALTER COLUMN \"user_id\" SET NOT NULL;",
      "\r\nALTER TABLE \"files_to_sessions\" ALTER COLUMN \"user_id\" SET NOT NULL;",
      "\r\n\r\n-- Add foreign key constraints\r\nALTER TABLE \"global_files\"\r\n  ADD CONSTRAINT \"global_files_creator_users_id_fk\"\r\n    FOREIGN KEY (\"creator\") REFERENCES \"public\".\"users\"(\"id\")\r\n      ON DELETE SET NULL ON UPDATE NO ACTION;",
      "\r\n\r\nALTER TABLE \"knowledge_base_files\"\r\n  ADD CONSTRAINT \"knowledge_base_files_user_id_users_id_fk\"\r\n    FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\")\r\n      ON DELETE CASCADE ON UPDATE NO ACTION;",
      "\r\n\r\nALTER TABLE \"message_chunks\"\r\n  ADD CONSTRAINT \"message_chunks_user_id_users_id_fk\"\r\n    FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\")\r\n      ON DELETE CASCADE ON UPDATE NO ACTION;",
      "\r\n\r\nALTER TABLE \"message_plugins\"\r\n  ADD CONSTRAINT \"message_plugins_user_id_users_id_fk\"\r\n    FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\")\r\n      ON DELETE CASCADE ON UPDATE NO ACTION;",
      "\r\n\r\nALTER TABLE \"message_queries\"\r\n  ADD CONSTRAINT \"message_queries_user_id_users_id_fk\"\r\n    FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\")\r\n      ON DELETE CASCADE ON UPDATE NO ACTION;",
      "\r\n\r\nALTER TABLE \"message_query_chunks\"\r\n  ADD CONSTRAINT \"message_query_chunks_user_id_users_id_fk\"\r\n    FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\")\r\n      ON DELETE CASCADE ON UPDATE NO ACTION;",
      "\r\n\r\nALTER TABLE \"message_tts\"\r\n  ADD CONSTRAINT \"message_tts_user_id_users_id_fk\"\r\n    FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\")\r\n      ON DELETE CASCADE ON UPDATE NO ACTION;",
      "\r\n\r\nALTER TABLE \"message_translates\"\r\n  ADD CONSTRAINT \"message_translates_user_id_users_id_fk\"\r\n    FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\")\r\n      ON DELETE CASCADE ON UPDATE NO ACTION;",
      "\r\n\r\nALTER TABLE \"messages_files\"\r\n  ADD CONSTRAINT \"messages_files_user_id_users_id_fk\"\r\n    FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\")\r\n      ON DELETE CASCADE ON UPDATE NO ACTION;",
      "\r\n\r\nALTER TABLE \"agents_to_sessions\"\r\n  ADD CONSTRAINT \"agents_to_sessions_user_id_users_id_fk\"\r\n    FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\")\r\n      ON DELETE CASCADE ON UPDATE NO ACTION;",
      "\r\n\r\nALTER TABLE \"file_chunks\"\r\n  ADD CONSTRAINT \"file_chunks_user_id_users_id_fk\"\r\n    FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\")\r\n      ON DELETE CASCADE ON UPDATE NO ACTION;",
      "\r\n\r\nALTER TABLE \"files_to_sessions\"\r\n  ADD CONSTRAINT \"files_to_sessions_user_id_users_id_fk\"\r\n    FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\")\r\n      ON DELETE CASCADE ON UPDATE NO ACTION;",
      "\r\n\r\nCOMMIT;",
      "\r\n"
    ],
    "bps": true,
    "folderMillis": 1742269437903,
    "hash": "4b794e5b93941806fae80dabc1d400df5ab762d123a60dceac1905929aca62e2"
  },
  {
    "sql": [
      "ALTER TABLE \"session_groups\" DROP CONSTRAINT IF EXISTS \"session_group_client_id_user_unique\";",
      "\r\nALTER TABLE \"sessions\" DROP CONSTRAINT IF EXISTS \"sessions_client_id_user_id_unique\";",
      "\r\nALTER TABLE \"topics\" DROP CONSTRAINT IF EXISTS \"topic_client_id_user_id_unique\";",
      "\r\n\r\n-- add client_id column\r\nALTER TABLE \"agents\" ADD COLUMN IF NOT EXISTS \"client_id\" text;",
      "\r\nALTER TABLE \"files\" ADD COLUMN IF NOT EXISTS \"client_id\" text;",
      "\r\nALTER TABLE \"knowledge_bases\" ADD COLUMN IF NOT EXISTS \"client_id\" text;",
      "\r\nALTER TABLE \"message_plugins\" ADD COLUMN IF NOT EXISTS \"client_id\" text;",
      "\r\nALTER TABLE \"message_queries\" ADD COLUMN IF NOT EXISTS \"client_id\" text;",
      "\r\nALTER TABLE \"message_tts\" ADD COLUMN IF NOT EXISTS \"client_id\" text;",
      "\r\nALTER TABLE \"message_translates\" ADD COLUMN IF NOT EXISTS \"client_id\" text;",
      "\r\nALTER TABLE \"chunks\" ADD COLUMN IF NOT EXISTS \"client_id\" text;",
      "\r\nALTER TABLE \"embeddings\" ADD COLUMN IF NOT EXISTS \"client_id\" text;",
      "\r\nALTER TABLE \"unstructured_chunks\" ADD COLUMN IF NOT EXISTS \"client_id\" text;",
      "\r\nALTER TABLE \"threads\" ADD COLUMN IF NOT EXISTS \"client_id\" text;",
      "\r\n\r\n-- Create unique indexusing IF NOT EXISTS\r\nCREATE UNIQUE INDEX IF NOT EXISTS \"client_id_user_id_unique\" ON \"agents\" USING btree (\"client_id\",\"user_id\");",
      "\r\nCREATE UNIQUE INDEX IF NOT EXISTS \"files_client_id_user_id_unique\" ON \"files\" USING btree (\"client_id\",\"user_id\");",
      "\r\nCREATE UNIQUE INDEX IF NOT EXISTS \"knowledge_bases_client_id_user_id_unique\" ON \"knowledge_bases\" USING btree (\"client_id\",\"user_id\");",
      "\r\nCREATE UNIQUE INDEX IF NOT EXISTS \"message_plugins_client_id_user_id_unique\" ON \"message_plugins\" USING btree (\"client_id\",\"user_id\");",
      "\r\nCREATE UNIQUE INDEX IF NOT EXISTS \"message_queries_client_id_user_id_unique\" ON \"message_queries\" USING btree (\"client_id\",\"user_id\");",
      "\r\nCREATE UNIQUE INDEX IF NOT EXISTS \"message_tts_client_id_user_id_unique\" ON \"message_tts\" USING btree (\"client_id\",\"user_id\");",
      "\r\nCREATE UNIQUE INDEX IF NOT EXISTS \"message_translates_client_id_user_id_unique\" ON \"message_translates\" USING btree (\"client_id\",\"user_id\");",
      "\r\nCREATE UNIQUE INDEX IF NOT EXISTS \"chunks_client_id_user_id_unique\" ON \"chunks\" USING btree (\"client_id\",\"user_id\");",
      "\r\nCREATE UNIQUE INDEX IF NOT EXISTS \"embeddings_client_id_user_id_unique\" ON \"embeddings\" USING btree (\"client_id\",\"user_id\");",
      "\r\nCREATE UNIQUE INDEX IF NOT EXISTS \"unstructured_chunks_client_id_user_id_unique\" ON \"unstructured_chunks\" USING btree (\"client_id\",\"user_id\");",
      "\r\nCREATE UNIQUE INDEX IF NOT EXISTS \"session_groups_client_id_user_id_unique\" ON \"session_groups\" USING btree (\"client_id\",\"user_id\");",
      "\r\nCREATE UNIQUE INDEX IF NOT EXISTS \"sessions_client_id_user_id_unique\" ON \"sessions\" USING btree (\"client_id\",\"user_id\");",
      "\r\nCREATE UNIQUE INDEX IF NOT EXISTS \"threads_client_id_user_id_unique\" ON \"threads\" USING btree (\"client_id\",\"user_id\");",
      "\r\nCREATE UNIQUE INDEX IF NOT EXISTS \"topics_client_id_user_id_unique\" ON \"topics\" USING btree (\"client_id\",\"user_id\");\r\n"
    ],
    "bps": true,
    "folderMillis": 1742616026643,
    "hash": "0c9a130076a59f554113eb3190201cb8d34e2b07f3f5cbf81264d9dc89a01427"
  },
  {
    "sql": ["ALTER TABLE \"user_settings\" ADD COLUMN \"hotkey\" jsonb;"],
    "bps": true,
    "folderMillis": 1742806552131,
    "hash": "7d5ee524b0f60bb5423512621cfe0793303c6556bf780b639dd926b475436f75"
  }
]
